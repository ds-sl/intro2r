---
title: "Big Mac Index"
output: html_notebook
---

## Our Big Mac index shows how burger prices are changing

* [Economist Site](https://www.economist.com/big-mac-index)
* [GitHub Site](https://github.com/TheEconomist/big-mac-data)

### What is Big Mac Index?

**Quote From the [Economist Site](https://www.economist.com/big-mac-index)**

The big mac index was invented by The Economist in 1986 as a lighthearted guide to whether currencies are at their “correct” level. It is based on the theory of purchasing-power parity (PPP), the notion that in the long run exchange rates should move towards the rate that would equalise the prices of an identical basket of goods and services (in this case, a burger) in any two countries.

Burgernomics was never intended as a precise gauge of currency misalignment, merely a tool to make exchange-rate theory more digestible. Yet the Big Mac index has become a global standard, included in several economic textbooks and the subject of dozens of academic studies. For those who take their fast food more seriously, we also calculate a gourmet version of the index.

#### RAW Index

**The British pound is 12.9% undervalued against the US dollar
January 2023**

A Big Mac costs £3.79 in Britain and US$5.36 in the United States. The implied exchange rate is 0.71. The difference between this and the actual exchange rate, 0.81, suggests the British pound is 12.9% undervalued

#### GDP Adjusted

**The British pound is 7.2% undervalued against the US dollar
January 2023**

A Big Mac costs 12.9% less in Britain (US$4.67) than in the United States (US$5.36) at market exchange rates. Based on differences in GDP per person, a Big Mac should cost 6.1% less. This suggests the pound is 7.2% undervalued


### Setup - Importing Full Data

```{r}
library(tidyverse)
library(lubridate)
```

```{r}
url_full <- "https://TheEconomist.github.io/big-mac-data/output-data/big-mac-full-index.csv"
```

```{r}
df_url <- read_csv(url_full); df_url
```

```{r}
bigmac <- read_csv("./data/big-mac-full-index.csv"); bigmac
```

```{r}
glimpse(bigmac)
```

```{r}
bigmac_source <- read_csv("./data/big-mac-source-data-v2.csv")
bigmac_source
```

```{r}
glimpse(bigmac_source)
```
```{r}
bigmac_source_rev <- bigmac_source %>%
  select(date, iso_a3, GDP_dollar, GDP_local)
bigmac_source_rev
```

```{r}
bigmac_long <- bigmac %>% left_join(bigmac_source_rev, by = c("date" = "date", "iso_a3" = "iso_a3"))
bigmac_long
```

```{r}
bigmac %>% distinct(name) %>% pull()
```

```{r}
code_book <- read_delim(clipboard()); code_book
```

```{r}
bigmac %>% filter(name == "Japan")
```
```{r}
bigmac %>% filter(name == "Japan") %>%
  ggplot(aes(date, dollar_ex)) + geom_line()
```

* **local_price**: Price of a Big Mac in the local currency  
* **dollar_price**: Price of a Big Mac in dollars
* **dollar_ex**: Local currency units per dollar  
* **USD_raw**: Raw index, relative to the US dollar 
* **adj_price**: GDP-adjusted price of a Big Mac, in dollars
* **JPY_raw**: Raw index, relative to the Japanese yen
* **GDP_bigmac**: 
* **GDP_dollar**: GDP per person, in dollars - in source
* **JPY_adjusted**: Adjusted index, relative to the Japanese yen 

#### Mankiw's Table, 2008 version


```{r}
bigmac_long %>% filter(date == '2008-06-01', name=='United States')
```

```{r}
bigmac_long %>% drop_na(dollar_price, GDP_dollar) %>%
  filter(name == "Japan") %>%
  ggplot(aes(GDP_dollar, dollar_price)) + geom_line() +
  geom_smooth(method = "lm", formula = y~x, se = FALSE)
```

```{r}
bigmac_long %>% drop_na(dollar_price, GDP_dollar) %>%
  filter(name == "Britain") %>%
  ggplot(aes(GDP_dollar, dollar_price)) + geom_line() +
  geom_smooth(method = "lm", formula = y~x, se = FALSE)
```

```{r}
bigmac_long %>% drop_na(dollar_price, GDP_dollar) %>%
  ggplot(aes(GDP_dollar, dollar_price)) + 
  geom_smooth(method = "loess", formula = y~x, se = FALSE, col = "red") +
  geom_smooth(method = "lm", formula = y~x, se = FALSE)
```

```{r}
model <- bigmac_long %>% lm(dollar_price ~ GDP_dollar, .)
model2008 <- bigmac_long %>% filter(date == '2008-06-01') %>% lm(dollar_price ~ GDP_dollar, .)
```

```{r}
regression_countries = c('ARG', 'AUS', 'BRA', 'GBR', 'CAN', 'CHL', 'CHN', 'CZE', 'DNK',
                         'EGY', 'EUZ', 'HKG', 'HUN', 'IDN', 'ISR', 'JPN', 'MYS', 'MEX',
                         'NZL', 'NOR', 'PER', 'PHL', 'POL', 'RUS', 'SAU', 'SGP', 'ZAF',
                         'KOR', 'SWE', 'CHE', 'TWN', 'THA', 'TUR', 'USA', 'COL', 'PAK',
                         'IND', 'AUT', 'BEL', 'NLD', 'FIN', 'FRA', 'DEU', 'IRL', 'ITA',
                         'PRT', 'ESP', 'GRC', 'EST')
# in 2021, we added a number of additional countries to the adjusted index
regression_addons_2021 = c('ARE', 'CRI', 'LKA', 'UKR', 'URY', 'VNM', 'GTM', 'HND', 'NIC',
                           'AZE', 'BHR', 'HRV', 'JOR', 'KWT', 'MDA', 'OMN', 'QAT', 'ROU',
                           'SVK', 'SVN', 'LVA', 'LTU')
model <- bigmac_long %>% lm(dollar_price ~ GDP_dollar, .)
model2008 <- bigmac_long %>% filter(date == '2008-06-01') %>% lm(dollar_price ~ GDP_dollar, .)
model_new <- bigmac_long %>% 
  filter(iso_a3 %in% regression_countries | iso_a3 %in% regression_addons_2021 & date >= as.Date('2021-01-01')) %>% 
  lm(dollar_price ~ GDP_dollar, .)
```

```{r}
library(modelr)
bigmac_long %>% add_predictions(model, var = "pred") %>% 
  add_predictions(model2008, var = "pred2008") %>% 
  add_predictions(model_new, var = "pred_new") %>%
  filter(date == '2008-06-01') %>%
  select(name, adj_price, pred, pred2008, pred_new) 
```

```{r}
bigmac_us <- bigmac_long %>% filter(date == '2008-06-01', name=='United States') %>% pull(local_price)
bigmac_us
gdppercap_us <- bigmac_long %>% filter(date == '2008-06-01', name=='United States') %>% pull(GDP_dollar)
gdppercap_us
```


```{r}
library(modelr)
bigmac_long %>% filter(date == '2008-06-01') %>% 
  drop_na(dollar_ex) %>% drop_na(GDP_dollar) %>%
  mutate(raw_in_dollar = local_price/dollar_ex) %>%
  mutate(ajusted_in_dollar = bigmac_us * GDP_dollar/gdppercap_us) %>%
  select(name, dollar_price, raw_in_dollar, adj_price, ajusted_in_dollar)
```

```{r}
bigmac_long %>% filter(date == '2008-06-01') %>% 
  drop_na(dollar_ex) %>% drop_na(GDP_dollar) %>%
  mutate(raw_in_dollar = local_price/dollar_ex) %>%
  mutate(ajusted_in_dollar = bigmac_us * GDP_dollar/gdppercap_us) %>%
  select(name, dollar_price, raw_in_dollar, adj_price, ajusted_in_dollar)
```


```{r}
bigmac %>% filter(date == '2008-06-01') %>% drop_na(dollar_ex) %>%
  mutate(raw_in_dollar = local_price/dollar_ex) %>%
  mutate(ajusted_in_dollar = bigmac_us * gdppercap_us /GDP_bigmac) %>%
  select(name, dollar_price, raw_in_dollar, adj_price, ajusted_in_dollar)
```

```{r}
bigmac %>% filter(date == '2008-06-01') %>% mutate(raw_in_dollor = 3.21 * dollar_ex) %>%
  select(name, currency_code, local_price, dollar_price, predict)
```

```{r}
bigmac %>% filter(date == '2008-06-01') %>% mutate(predict = 3.21 * dollar_ex) %>%
  select(name, currency_code, local_price, dollar_price, predict)
```

### Original R Script

#### big-mac-data/data-generator-v2.R

```{r}
## Changed from Original
## "./source-data" -> "./data"
library('tidyverse')
library('data.table')

big_mac_countries = c('ARG', 'AUS', 'BRA', 'GBR', 'CAN', 'CHL', 'CHN', 'CZE', 'DNK',
                      'EGY', 'HKG', 'HUN', 'IDN', 'ISR', 'JPN', 'MYS', 'MEX', 'NZL',
                      'NOR', 'PER', 'PHL', 'POL', 'RUS', 'SAU', 'SGP', 'ZAF', 'KOR',
                      'SWE', 'CHE', 'TWN', 'THA', 'TUR', 'ARE', 'USA', 'COL', 'CRI',
                      'PAK', 'LKA', 'UKR', 'URY', 'IND', 'VNM', 'GTM', 'HND', 'VEN',
                      'NIC', 'AZE', 'BHR', 'HRV', 'JOR', 'KWT', 'LBN', 'MDA', 'OMN',
                      'QAT', 'ROU', 'EUZ')

big_mac_data = fread('./source-data/big-mac-source-data-v2.csv', na.strings = '#N/A') %>%
    .[!is.na(local_price)] %>%                    # remove lines where the local price is missing
    .[,GDP_local := as.numeric(GDP_local)] %>%    # convert GDP to a number
    .[order(date, name)]                          # sort by date and then by country name, for easy reading

latest_date = big_mac_data$date %>% max

big_mac_data[, dollar_price := local_price / dollar_ex]

base_currencies = c('USD', 'EUR', 'GBP', 'JPY', 'CNY')

big_mac_index = big_mac_data[
    !is.na(dollar_price) & iso_a3 %in% big_mac_countries
    ,.(date, iso_a3, currency_code, name, local_price, dollar_ex, dollar_price)]

for(currency in base_currencies) {
    big_mac_index[
        ,                           # we don't want a subset, so our first argument is blank
        (currency) :=               # we'll add a new column named for the base set
            dollar_price /          # we divide the dollar price in each row by
                                    # the dollar price on the *base currency*'s row (.SD is a data.table
            .SD[currency_code == currency]$dollar_price -        # that contains only the current group)
            1,                      # one means parity (neither over- nor under-valued), so we subtract one
                                    # to get an over/under-valuation value
        by=date                     # and of course, we'll group these rows by date
    ]
}
big_mac_index[, (base_currencies) := round(.SD, 5L), .SDcols=base_currencies]

to_plot = big_mac_index[date == latest_date]
to_plot$name = factor(to_plot$name, levels=to_plot$name[order(to_plot$USD)])

fwrite(big_mac_index, './output-data/big-mac-raw-index.csv')

big_mac_gdp_data = big_mac_data[GDP_local > 0]

regression_countries = c('ARG', 'AUS', 'BRA', 'GBR', 'CAN', 'CHL', 'CHN', 'CZE', 'DNK',
                         'EGY', 'EUZ', 'HKG', 'HUN', 'IDN', 'ISR', 'JPN', 'MYS', 'MEX',
                         'NZL', 'NOR', 'PER', 'PHL', 'POL', 'RUS', 'SAU', 'SGP', 'ZAF',
                         'KOR', 'SWE', 'CHE', 'TWN', 'THA', 'TUR', 'USA', 'COL', 'PAK',
                         'IND', 'AUT', 'BEL', 'NLD', 'FIN', 'FRA', 'DEU', 'IRL', 'ITA',
                         'PRT', 'ESP', 'GRC', 'EST')
# in 2021, we added a number of additional countries to the adjusted index
regression_addons_2021 = c('ARE', 'CRI', 'LKA', 'UKR', 'URY', 'VNM', 'GTM', 'HND', 'NIC',
                           'AZE', 'BHR', 'HRV', 'JOR', 'KWT', 'MDA', 'OMN', 'QAT', 'ROU',
                           'SVK', 'SVN', 'LVA', 'LTU')
big_mac_gdp_data = big_mac_gdp_data[iso_a3 %in% regression_countries |
  (iso_a3 %in% regression_addons_2021 & date >= as.Date('2021-01-01'))
]

big_mac_gdp_data %>%
    .[,GDP_bigmac := GDP_local / (local_price / .SD[iso_a3=='USA']$local_price), by=date]

big_mac_gdp_data[
    ,
    `:=`(
        adj_price=lm(dollar_price ~ GDP_bigmac) %>% predict
#         adj_price_USD=lm(dollar_price ~ GDP_dollar) %>% predict
    ),
    by = date]

big_mac_adj_index = big_mac_gdp_data[
    !is.na(dollar_price) &
    (
        iso_a3 %in% regression_countries |
        iso_a3 %in% regression_addons_2021 & date >= '2021-01-01'
    ) &
    iso_a3 %in% big_mac_countries
    ,.(date, iso_a3, currency_code, name, local_price, dollar_ex, dollar_price, GDP_bigmac, adj_price)]

for(currency in base_currencies) {
    big_mac_adj_index[
        ,                           # we don't want a subset, so our first argument is blank
        (currency) :=               # we'll add a new column named for the base set
            (                       # we divide the dollar price by the adjusted price to get
                dollar_price / adj_price  # the deviation from our expectation by
            ) /
                                    # the same figure from the *base currency*'s rowa\
            (
                .SD[currency_code == currency]$dollar_price /
                .SD[currency_code == currency]$adj_price
            ) -
            1,                      # one means parity (neither over- nor under-valued), so we subtract one
                                    # to get an over/under-valuation value
        by=date                     # and of course, we'll group these rows by date
    ]
}
big_mac_adj_index[, (base_currencies) := round(.SD, 5L), .SDcols=base_currencies]

fwrite(big_mac_adj_index, './output-data/big-mac-adjusted-index.csv')

big_mac_full_index = merge(big_mac_index, big_mac_adj_index,
      by=c('date', 'iso_a3', 'currency_code', 'name', 'local_price', 'dollar_ex', 'dollar_price'),
      suffixes=c('_raw', '_adjusted'),
      all.x=TRUE
     )

fwrite(big_mac_full_index, './output-data/big-mac-full-index.csv')
```

# README

# The Big Mac index

This repository contains the data behind _The Economist’s_ Big Mac index, and code that shows how we calculate it. To download the data, go to the [latest release][latest release], where you can download the index data in a CSV or Excel, or the [code behind it][notebook link].

## Methodology changes

In July 2022 we updated the Big Mac index to use a McDonalds-provided price for the United States (previously, we averaged the price from four major US cities). We also changed how we calculate the GDP-adjusted index. Instead of using the IMF's calculation of purchasing-power parity, we adjust the GDP per person by the difference in each country's Big Mac prices. The full history of the GDP-adjusted series will now be updated whenever the IMF’s historical GDP series are updated, which means the GDP series for a given year may change slightly over time as the IMF refines its measurements. The previously published versions of both indices are available in the [releases](https://github.com/TheEconomist/big-mac-data/releases).

## Source data

Our source data are from several places. Big Mac prices are from McDonald’s directly and from reporting around the world; exchange rates are from Thomson Reuters (until January 2022) and Refinitiv Datastream (July 2022 on); GDP and population data used to calculate the euro area averages are from Eurostat and GDP per person data are from the IMF World Economic Outlook reports.

## Output data

The script provides data in three files:

- `big-mac-raw-index.csv` contains values for the “raw” index
- `big-mac-adjusted-index.csv` contains values for the “adjusted” index
- `big-mac-full-index.csv` contains both

Each file also contains the source data used to calculate it.

#### Codebook

This codebook largely applies to all three files. The exception is the variables suffixed "\_raw" or "\_adjusted"—these appear (with suffixes) in the "full" file but without suffixes in the respective ("raw" or "adjusted") files.

| variable      | definition                                            | source                     |
| ------------- | ----------------------------------------------------- | -------------------------- |
| date          | Date of observation                                   |
| iso_a3        | Three-character [ISO 3166-1 country code][iso 3166-1] |
| currency_code | Three-character [ISO 4217 currency code][iso 4217]    |
| name          | Country name                                          |
| local_price   | Price of a Big Mac in the local currency              | McDonalds; _The Economist_ |
| dollar_ex     | Local currency units per dollar                       | _Reuters_                  |
| dollar_price  | Price of a Big Mac in dollars                         |
| USD_raw       | Raw index, relative to the US dollar                  |
| EUR_raw       | Raw index, relative to the Euro                       |
| GBP_raw       | Raw index, relative to the British pound              |
| JPY_raw       | Raw index, relative to the Japanese yen               |
| CNY_raw       | Raw index, relative to the Chinese yuan               |
| GDP_dollar    | GDP per person, in dollars                            | IMF                        |
| adj_price     | GDP-adjusted price of a Big Mac, in dollars           |
| USD_adjusted  | Adjusted index, relative to the US dollar             |
| EUR_adjusted  | Adjusted index, relative to the Euro                  |
| GBP_adjusted  | Adjusted index, relative to the British pound         |
| JPY_adjusted  | Adjusted index, relative to the Japanese yen          |
| CNY_adjusted  | Adjusted index, relative to the Chinese yuan          |

## Calculating the Big Mac index

The code to calculate the index is provided as a [Jupyter Notebook][jupyter]. The code itself is written in R, a programming language designed for data manipulation and statistics. You can view the [notebook][notebook link] on github.

If you want to run the notebook, you’ll need to set up a few things:

### Install Python

You can refer to the installation instructions at the [Hitchhiker’s Guide to Python][h2g2py install]

**On a Mac**, you already have Python 2.7 installed, but it does not come with Python’s package manager. We recommend using Python 3. To install it, we recommend using [Homebrew][homebrew]. In terminal, install Homebrew:

```
$ /usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
```

Then, use Homebrew to install Python 3.x:

```
$ brew install python3
```

**On Ubuntu Linux** you can use aptitude:

```
$ sudo apt-get update
$ sudo apt-get install python3.6
```

**On Windows**, instructions coming.

### Install Jupyter

**On Mac or Linux**, you should now also have pip installed. pip is a package manager for Python. You can install [Jupyter][jupyter] with pip:

```
$ python3 -m pip install jupyter
```

You’re all set. (If you are using Python 2, run `python -m pip install jupyter`.)

**On Windows**, instructions coming.

### Install R

**On a Mac**, use Homebrew again. At a terminal prompt, run:

```
$ brew install R
```

**On Ubuntu Linux**, you’re recommended to add a new source to your aptitude setup to install R. Run:

```
$ sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys E298A3A825C0D65DFD57CBB651716619E084DAB9
```

Once you have added the key, add R repository (called CRAN):

```
$ sudo add-apt-repository 'deb [arch=amd64,i386] https://cran.rstudio.com/bin/linux/ubuntu xenial/'
```

Now, you can install R:

```
$ sudo apt-get update
$ sudo apt-get install r-base
```

**On Windows**, instructions coming.

### Install IRkernel

[IRKernel][irkernel] lets you run R code in Jupyter notebooks. This is the best way to work with R code (this is a truth not yet universally acknowledged). Installation instructions for IRKernel are [here][irkernel installation]. In short:

At a terminal prompt, start R:

```
$ R
> install.packages(c('repr', 'IRdisplay', 'evaluate', 'crayon', 'pbdZMQ', 'devtools', 'uuid', 'digest'))
> devtools::install_github('IRkernel/IRkernel')
> IRkernel::installspec()
```

Congratulations, you can run R in Jupyter.

### Install tidyverse and data.table

Finally, our R script uses a few R packages you’ll need to install. The [tidyverse][tidyverse] is a collection of useful packages for data science work in R. [Data.table][data.table] is a complicated but extremely useful alternative to R’s standard data frames for storing and manipulating data. At the R prompt from above, run:

```
> install.packages(c('tidyverse','data.table'))
```

You’re all set.

### Start the notebook

Navigate to the repository on the command line, and run:

```
$ jupyter notebook
```

You should see a browser window pop up on `http://localhost:8888`. Click on “Big Mac data generator” to launch the notebook.

To run the notebook, you can run the code cell by cell by clicking on the first cell and using <kbd>shift</kbd>+<kbd>enter</kbd> to run each cell in turn. Or you can run the whole thing by clicking on the “Cell” menu and selecting “Run All”.

### R script

We also include the calculation as a bare R script (`data-generator.R`) if you just want to run the code, but this doesn't explain what the code does or walk you through it. To run this, you'll only need to install R, tidyverse, and data.table; once those are installed, you can just run

```
$ R data-generator-v2.R
```

to calculate the index files. (The R script may generate numbers that are different at the last decimal place to those from the Python notebook—these differences are due to rounding errors and can be safely ignored.)

### Licence

This software is published by _[The Economist](https://www.economist.com)_ under the [MIT licence](https://opensource.org/licenses/MIT). The data generated by _The Economist_ are available under the [Creative Commons Attribution 4.0 International License](https://creativecommons.org/licenses/by/4.0/).

The licences include only the data and the software authored by _The Economist_, and do not cover any _Economist_ content or third-party data or content made available using the software. More information about licensing, syndication and the copyright of _Economist_ content can be found [here](https://www.economist.com/rights/).

[releases]: https://github.com/theeconomist/big-mac-data/releases
[latest release]: https://github.com/theeconomist/big-mac-data/releases/latest
[notebook link]: https://github.com/theeconomist/big-mac-data/blob/master/Big%20Mac%20data%20generator.ipynb
[homebrew]: https://brew.sh/
[h2g2py install]: http://docs.python-guide.org/en/latest/starting/installation/
[h2g2py windows install]: http://docs.python-guide.org/en/latest/starting/install3/win/#install3-windows
[jupyter]: https://jupyter.org
[irkernel]: https://irkernel.github.io/
[irkernel installation]: https://irkernel.github.io/installation/
[tidyverse]: https://www.tidyverse.org/
[data.table]: https://cran.r-project.org/web/packages/data.table/vignettes/datatable-intro.html
[iso 3166-1]: https://www.iso.org/iso-3166-country-codes.html
[iso 4217]: https://www.iso.org/iso-4217-currency-codes.html


### Code

#### big-mac-data/data-generator-v2.R

```{r}
## Changed from Original
## "./source-data" -> "./data"
library('tidyverse')
#library('data.table')

big_mac_countries = c('ARG', 'AUS', 'BRA', 'GBR', 'CAN', 'CHL', 'CHN', 'CZE', 'DNK',
                      'EGY', 'HKG', 'HUN', 'IDN', 'ISR', 'JPN', 'MYS', 'MEX', 'NZL',
                      'NOR', 'PER', 'PHL', 'POL', 'RUS', 'SAU', 'SGP', 'ZAF', 'KOR',
                      'SWE', 'CHE', 'TWN', 'THA', 'TUR', 'ARE', 'USA', 'COL', 'CRI',
                      'PAK', 'LKA', 'UKR', 'URY', 'IND', 'VNM', 'GTM', 'HND', 'VEN',
                      'NIC', 'AZE', 'BHR', 'HRV', 'JOR', 'KWT', 'LBN', 'MDA', 'OMN',
                      'QAT', 'ROU', 'EUZ')
```


```{r}
big_mac_data <- read_csv('./data/big-mac-source-data-v2.csv') %>% 
  drop_na(local_price)
big_mac_data
```


```{r}
latest_date <-  big_mac_data$date %>% max
latest_date
```


```{r}
big_mac_data <- big_mac_data %>% mutate(dollar_price = local_price / dollar_ex)
```


```{r}
base_currencies = c('USD', 'EUR', 'GBP', 'JPY', 'CNY')
```


```{r}
big_mac_index <- big_mac_data %>% drop_na(dollar_price) %>%
  filter(iso_a3 %in% big_mac_countries) %>%
  select(date, iso_a3, currency_code, name, local_price, dollar_ex, dollar_price)
```



```{r}
# library(data.table)
for(currency in base_currencies) {
    mutate(big_mac_index, currency = dollar_price / 
            .SD[currency_code == currency]$dollar_price -        # that contains only the current group)
            1,                      # one means parity (neither over- nor under-valued), so we subtract one
                                    # to get an over/under-valuation value
        by=date                     # and of course, we'll group these rows by date
    ]
}
```


```{r}
big_mac_index[, (base_currencies) := round(.SD, 5L), .SDcols=base_currencies]

to_plot <- big_mac_index %>% filter(date == latest_date)
to_plot$name <- factor(to_plot$name, levels=to_plot$name[order(to_plot$USD)])

big_mac_index <- write_csv('./data/big-mac-raw-index.csv')

big_mac_gdp_data <- big_mac_data[GDP_local > 0]

regression_countries = c('ARG', 'AUS', 'BRA', 'GBR', 'CAN', 'CHL', 'CHN', 'CZE', 'DNK',
                         'EGY', 'EUZ', 'HKG', 'HUN', 'IDN', 'ISR', 'JPN', 'MYS', 'MEX',
                         'NZL', 'NOR', 'PER', 'PHL', 'POL', 'RUS', 'SAU', 'SGP', 'ZAF',
                         'KOR', 'SWE', 'CHE', 'TWN', 'THA', 'TUR', 'USA', 'COL', 'PAK',
                         'IND', 'AUT', 'BEL', 'NLD', 'FIN', 'FRA', 'DEU', 'IRL', 'ITA',
                         'PRT', 'ESP', 'GRC', 'EST')
# in 2021, we added a number of additional countries to the adjusted index
regression_addons_2021 = c('ARE', 'CRI', 'LKA', 'UKR', 'URY', 'VNM', 'GTM', 'HND', 'NIC',
                           'AZE', 'BHR', 'HRV', 'JOR', 'KWT', 'MDA', 'OMN', 'QAT', 'ROU',
                           'SVK', 'SVN', 'LVA', 'LTU')
big_mac_gdp_data <- big_mac_gdp_data %>% filter(iso_a3 %in% regression_countries |
  (iso_a3 %in% regression_addons_2021 & date >= as.Date('2021-01-01')))

big_mac_gdp_data %>%
    .[,GDP_bigmac := GDP_local / (local_price / .SD[iso_a3=='USA']$local_price), by=date]

big_mac_gdp_data[
    ,
    `:=`(
        adj_price=lm(dollar_price ~ GDP_bigmac) %>% predict
#         adj_price_USD=lm(dollar_price ~ GDP_dollar) %>% predict
    ),
    by = date]

big_mac_adj_index <- big_mac_gdp_data[
    !is.na(dollar_price) &
    (
        iso_a3 %in% regression_countries |
        iso_a3 %in% regression_addons_2021 & date >= '2021-01-01'
    ) &
    iso_a3 %in% big_mac_countries
    ,.(date, iso_a3, currency_code, name, local_price, dollar_ex, dollar_price, GDP_bigmac, adj_price)]

for(currency in base_currencies) {
    big_mac_adj_index[
        ,                           # we don't want a subset, so our first argument is blank
        (currency) :=               # we'll add a new column named for the base set
            (                       # we divide the dollar price by the adjusted price to get
                dollar_price / adj_price  # the deviation from our expectation by
            ) /
                                    # the same figure from the *base currency*'s rowa\
            (
                .SD[currency_code == currency]$dollar_price /
                .SD[currency_code == currency]$adj_price
            ) -
            1,                      # one means parity (neither over- nor under-valued), so we subtract one
                                    # to get an over/under-valuation value
        by=date                     # and of course, we'll group these rows by date
    ]
}
big_mac_adj_index[, (base_currencies) := round(.SD, 5L), .SDcols=base_currencies]

big_mac_adj_index %>% write_csv('./data/big-mac-adjusted-index.csv')

big_mac_full_index = merge(big_mac_index, big_mac_adj_index,
      by=c('date', 'iso_a3', 'currency_code', 'name', 'local_price', 'dollar_ex', 'dollar_price'),
      suffixes=c('_raw', '_adjusted'),
      all.x=TRUE
     )

big_mac_full_index %>% write_csv('./data/big-mac-full-index.csv')
```

#### Copied


---
title: "Big Mac Index"
output: html_notebook
---

## Our Big Mac index shows how burger prices are changing

* [Economist Site](https://www.economist.com/big-mac-index)
* [GitHub Site](https://github.com/TheEconomist/big-mac-data)

### What is Big Mac Index?

**Quote From the [Economist Site](https://www.economist.com/big-mac-index)**

The big mac index was invented by The Economist in 1986 as a lighthearted guide to whether currencies are at their “correct” level. It is based on the theory of purchasing-power parity (PPP), the notion that in the long run exchange rates should move towards the rate that would equalise the prices of an identical basket of goods and services (in this case, a burger) in any two countries.

Burgernomics was never intended as a precise gauge of currency misalignment, merely a tool to make exchange-rate theory more digestible. Yet the Big Mac index has become a global standard, included in several economic textbooks and the subject of dozens of academic studies. For those who take their fast food more seriously, we also calculate a gourmet version of the index.

#### RAW Index

**The British pound is 12.9% undervalued against the US dollar
January 2023**

A Big Mac costs £3.79 in Britain and US$5.36 in the United States. The implied exchange rate is 0.71. The difference between this and the actual exchange rate, 0.81, suggests the British pound is 12.9% undervalued

#### GDP Adjusted

**The British pound is 7.2% undervalued against the US dollar
January 2023**

A Big Mac costs 12.9% less in Britain (US$4.67) than in the United States (US$5.36) at market exchange rates. Based on differences in GDP per person, a Big Mac should cost 6.1% less. This suggests the pound is 7.2% undervalued


### Setup - Importing Full Data

```{r}
library(tidyverse)
library(lubridate)
```

```{r}
url_full <- "https://TheEconomist.github.io/big-mac-data/output-data/big-mac-full-index.csv"
```

```{r}
df_url <- read_csv(url_full); df_url
```

```{r}
bigmac <- read_csv("./data/big-mac-full-index.csv"); bigmac
```

```{r}
glimpse(bigmac)
```

```{r}
bigmac_source <- read_csv("./data/big-mac-source-data-v2.csv")
bigmac_source
```

```{r}
glimpse(bigmac_source)
```
```{r}
bigmac_source_rev <- bigmac_source %>%
  select(date, iso_a3, GDP_dollar, GDP_local)
bigmac_source_rev
```

```{r}
bigmac_long <- bigmac %>% left_join(bigmac_source_rev, by = c("date" = "date", "iso_a3" = "iso_a3"))
bigmac_long
```

```{r}
bigmac %>% distinct(name) %>% pull()
```

```{r}
code_book <- read_delim(clipboard()); code_book
```

```{r}
bigmac %>% filter(name == "Japan")
```
```{r}
bigmac %>% filter(name == "Japan") %>%
  ggplot(aes(date, dollar_ex)) + geom_line()
```

* **local_price**: Price of a Big Mac in the local currency  
* **dollar_price**: Price of a Big Mac in dollars
* **dollar_ex**: Local currency units per dollar  
* **USD_raw**: Raw index, relative to the US dollar 
* **adj_price**: GDP-adjusted price of a Big Mac, in dollars
* **JPY_raw**: Raw index, relative to the Japanese yen
* **GDP_bigmac**: 
* **GDP_dollar**: GDP per person, in dollars - in source
* **JPY_adjusted**: Adjusted index, relative to the Japanese yen 

#### Mankiw's Table, 2008 version


```{r}
bigmac_long %>% filter(date == '2008-06-01', name=='United States')
```

```{r}
bigmac_long %>% drop_na(dollar_price, GDP_dollar) %>%
  filter(name == "Japan") %>%
  ggplot(aes(GDP_dollar, dollar_price)) + geom_line() +
  geom_smooth(method = "lm", formula = y~x, se = FALSE)
```

```{r}
bigmac_long %>% drop_na(dollar_price, GDP_dollar) %>%
  filter(name == "Britain") %>%
  ggplot(aes(GDP_dollar, dollar_price)) + geom_line() +
  geom_smooth(method = "lm", formula = y~x, se = FALSE)
```

```{r}
bigmac_long %>% drop_na(dollar_price, GDP_dollar) %>%
  ggplot(aes(GDP_dollar, dollar_price)) + 
  geom_smooth(method = "loess", formula = y~x, se = FALSE, col = "red") +
  geom_smooth(method = "lm", formula = y~x, se = FALSE)
```

```{r}
model <- bigmac_long %>% lm(dollar_price ~ GDP_dollar, .)
model2008 <- bigmac_long %>% filter(date == '2008-06-01') %>% lm(dollar_price ~ GDP_dollar, .)
```

```{r}
regression_countries = c('ARG', 'AUS', 'BRA', 'GBR', 'CAN', 'CHL', 'CHN', 'CZE', 'DNK',
                         'EGY', 'EUZ', 'HKG', 'HUN', 'IDN', 'ISR', 'JPN', 'MYS', 'MEX',
                         'NZL', 'NOR', 'PER', 'PHL', 'POL', 'RUS', 'SAU', 'SGP', 'ZAF',
                         'KOR', 'SWE', 'CHE', 'TWN', 'THA', 'TUR', 'USA', 'COL', 'PAK',
                         'IND', 'AUT', 'BEL', 'NLD', 'FIN', 'FRA', 'DEU', 'IRL', 'ITA',
                         'PRT', 'ESP', 'GRC', 'EST')
# in 2021, we added a number of additional countries to the adjusted index
regression_addons_2021 = c('ARE', 'CRI', 'LKA', 'UKR', 'URY', 'VNM', 'GTM', 'HND', 'NIC',
                           'AZE', 'BHR', 'HRV', 'JOR', 'KWT', 'MDA', 'OMN', 'QAT', 'ROU',
                           'SVK', 'SVN', 'LVA', 'LTU')
model <- bigmac_long %>% lm(dollar_price ~ GDP_dollar, .)
model2008 <- bigmac_long %>% filter(date == '2008-06-01') %>% lm(dollar_price ~ GDP_dollar, .)
model_new <- bigmac_long %>% 
  filter(iso_a3 %in% regression_countries | iso_a3 %in% regression_addons_2021 & date >= as.Date('2021-01-01')) %>% 
  lm(dollar_price ~ GDP_dollar, .)
```

```{r}
library(modelr)
bigmac_long %>% add_predictions(model, var = "pred") %>% 
  add_predictions(model2008, var = "pred2008") %>% 
  add_predictions(model_new, var = "pred_new") %>%
  filter(date == '2008-06-01') %>%
  select(name, adj_price, pred, pred2008, pred_new) 
```

```{r}
bigmac_us <- bigmac_long %>% filter(date == '2008-06-01', name=='United States') %>% pull(local_price)
bigmac_us
gdppercap_us <- bigmac_long %>% filter(date == '2008-06-01', name=='United States') %>% pull(GDP_dollar)
gdppercap_us
```


```{r}
library(modelr)
bigmac_long %>% filter(date == '2008-06-01') %>% 
  drop_na(dollar_ex) %>% drop_na(GDP_dollar) %>%
  mutate(raw_in_dollar = local_price/dollar_ex) %>%
  mutate(ajusted_in_dollar = bigmac_us * GDP_dollar/gdppercap_us) %>%
  select(name, dollar_price, raw_in_dollar, adj_price, ajusted_in_dollar)
```

```{r}
bigmac_long %>% filter(date == '2008-06-01') %>% 
  drop_na(dollar_ex) %>% drop_na(GDP_dollar) %>%
  mutate(raw_in_dollar = local_price/dollar_ex) %>%
  mutate(ajusted_in_dollar = bigmac_us * GDP_dollar/gdppercap_us) %>%
  select(name, dollar_price, raw_in_dollar, adj_price, ajusted_in_dollar)
```


```{r}
bigmac %>% filter(date == '2008-06-01') %>% drop_na(dollar_ex) %>%
  mutate(raw_in_dollar = local_price/dollar_ex) %>%
  mutate(ajusted_in_dollar = bigmac_us * gdppercap_us /GDP_bigmac) %>%
  select(name, dollar_price, raw_in_dollar, adj_price, ajusted_in_dollar)
```

```{r}
bigmac %>% filter(date == '2008-06-01') %>% mutate(raw_in_dollor = 3.21 * dollar_ex) %>%
  select(name, currency_code, local_price, dollar_price, predict)
```

```{r}
bigmac %>% filter(date == '2008-06-01') %>% mutate(predict = 3.21 * dollar_ex) %>%
  select(name, currency_code, local_price, dollar_price, predict)
```

### Original R Script

#### big-mac-data/data-generator-v2.R

```{r}
## Changed from Original
## "./source-data" -> "./data"
library('tidyverse')
library('data.table')

big_mac_countries = c('ARG', 'AUS', 'BRA', 'GBR', 'CAN', 'CHL', 'CHN', 'CZE', 'DNK',
                      'EGY', 'HKG', 'HUN', 'IDN', 'ISR', 'JPN', 'MYS', 'MEX', 'NZL',
                      'NOR', 'PER', 'PHL', 'POL', 'RUS', 'SAU', 'SGP', 'ZAF', 'KOR',
                      'SWE', 'CHE', 'TWN', 'THA', 'TUR', 'ARE', 'USA', 'COL', 'CRI',
                      'PAK', 'LKA', 'UKR', 'URY', 'IND', 'VNM', 'GTM', 'HND', 'VEN',
                      'NIC', 'AZE', 'BHR', 'HRV', 'JOR', 'KWT', 'LBN', 'MDA', 'OMN',
                      'QAT', 'ROU', 'EUZ')

big_mac_data = fread('./data/big-mac-source-data-v2.csv', na.strings = '#N/A') %>%
    .[!is.na(local_price)] %>%                    # remove lines where the local price is missing
    .[,GDP_local := as.numeric(GDP_local)] %>%    # convert GDP to a number
    .[order(date, name)]                          # sort by date and then by country name, for easy reading

latest_date = big_mac_data$date %>% max

big_mac_data[, dollar_price := local_price / dollar_ex]

base_currencies = c('USD', 'EUR', 'GBP', 'JPY', 'CNY')

big_mac_index = big_mac_data[
    !is.na(dollar_price) & iso_a3 %in% big_mac_countries
    ,.(date, iso_a3, currency_code, name, local_price, dollar_ex, dollar_price)]

for(currency in base_currencies) {
    big_mac_index[
        ,                           # we don't want a subset, so our first argument is blank
        (currency) :=               # we'll add a new column named for the base set
            dollar_price /          # we divide the dollar price in each row by
                                    # the dollar price on the *base currency*'s row (.SD is a data.table
            .SD[currency_code == currency]$dollar_price -        # that contains only the current group)
            1,                      # one means parity (neither over- nor under-valued), so we subtract one
                                    # to get an over/under-valuation value
        by=date                     # and of course, we'll group these rows by date
    ]
}
big_mac_index[, (base_currencies) := round(.SD, 5L), .SDcols=base_currencies]

to_plot = big_mac_index[date == latest_date]
to_plot$name = factor(to_plot$name, levels=to_plot$name[order(to_plot$USD)])

fwrite(big_mac_index, './data/big-mac-raw-index.csv')

big_mac_gdp_data = big_mac_data[GDP_local > 0]

regression_countries = c('ARG', 'AUS', 'BRA', 'GBR', 'CAN', 'CHL', 'CHN', 'CZE', 'DNK',
                         'EGY', 'EUZ', 'HKG', 'HUN', 'IDN', 'ISR', 'JPN', 'MYS', 'MEX',
                         'NZL', 'NOR', 'PER', 'PHL', 'POL', 'RUS', 'SAU', 'SGP', 'ZAF',
                         'KOR', 'SWE', 'CHE', 'TWN', 'THA', 'TUR', 'USA', 'COL', 'PAK',
                         'IND', 'AUT', 'BEL', 'NLD', 'FIN', 'FRA', 'DEU', 'IRL', 'ITA',
                         'PRT', 'ESP', 'GRC', 'EST')
# in 2021, we added a number of additional countries to the adjusted index
regression_addons_2021 = c('ARE', 'CRI', 'LKA', 'UKR', 'URY', 'VNM', 'GTM', 'HND', 'NIC',
                           'AZE', 'BHR', 'HRV', 'JOR', 'KWT', 'MDA', 'OMN', 'QAT', 'ROU',
                           'SVK', 'SVN', 'LVA', 'LTU')
big_mac_gdp_data = big_mac_gdp_data[iso_a3 %in% regression_countries |
  (iso_a3 %in% regression_addons_2021 & date >= as.Date('2021-01-01'))
]

big_mac_gdp_data %>%
    .[,GDP_bigmac := GDP_local / (local_price / .SD[iso_a3=='USA']$local_price), by=date]

big_mac_gdp_data[
    ,
    `:=`(
        adj_price=lm(dollar_price ~ GDP_bigmac) %>% predict
#         adj_price_USD=lm(dollar_price ~ GDP_dollar) %>% predict
    ),
    by = date]

big_mac_adj_index = big_mac_gdp_data[
    !is.na(dollar_price) &
    (
        iso_a3 %in% regression_countries |
        iso_a3 %in% regression_addons_2021 & date >= '2021-01-01'
    ) &
    iso_a3 %in% big_mac_countries
    ,.(date, iso_a3, currency_code, name, local_price, dollar_ex, dollar_price, GDP_bigmac, adj_price)]

for(currency in base_currencies) {
    big_mac_adj_index[
        ,                           # we don't want a subset, so our first argument is blank
        (currency) :=               # we'll add a new column named for the base set
            (                       # we divide the dollar price by the adjusted price to get
                dollar_price / adj_price  # the deviation from our expectation by
            ) /
                                    # the same figure from the *base currency*'s rowa\
            (
                .SD[currency_code == currency]$dollar_price /
                .SD[currency_code == currency]$adj_price
            ) -
            1,                      # one means parity (neither over- nor under-valued), so we subtract one
                                    # to get an over/under-valuation value
        by=date                     # and of course, we'll group these rows by date
    ]
}
big_mac_adj_index[, (base_currencies) := round(.SD, 5L), .SDcols=base_currencies]

fwrite(big_mac_adj_index, './data/big-mac-adjusted-index.csv')

big_mac_full_index = merge(big_mac_index, big_mac_adj_index,
      by=c('date', 'iso_a3', 'currency_code', 'name', 'local_price', 'dollar_ex', 'dollar_price'),
      suffixes=c('_raw', '_adjusted'),
      all.x=TRUE
     )

fwrite(big_mac_full_index, './data/big-mac-full-index.csv')
```