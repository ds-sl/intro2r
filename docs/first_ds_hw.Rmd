---
title: "はじめてのデータ・サイエンス　課題"
author: "ID, Your Name"
date: "Last Updated: `r Sys.Date()`"
output:
  html_notebook:
    toc: yes
    toc_float: yes
    highlight: tango
    theme: cerulean
    number_sections: yes
---

# プロジェクト

他の WDI のデータで、データサイエンス。

プロジェクト1 までが課題。余裕があれば、プロジェクト２、プロジェクト3 に挑戦してください。

-   プロジェクト1：`gdp = "NY.GDP.MKTP.CD"` を、GNI per capita, Atlas method (current US\$): NY.GNP.PCAP.CD に置き換えてデータサイエンス（視覚化を通してデータを理解）。
    -   GDP の時のコードを下につけますから、コードを確認して、国などを必要に応じて変更して、気づいたこと、わかったこと、疑問に思ったことを書いていってください。
-   プロジェクト2：[World Development Indicators](https://datatopics.worldbank.org/world-development-indicators/) のサイトの下にある、Data Themes（テーマ）などから自分が調べたいテーマを選び、そのテーマから、データコードを取得して、同様の分析をしてみてください。データがあまりない場合もありますので、ある程度データが多いものを選択することをお勧めします。
-   プロジェクト3：可能なら、「3 R の パッケージ WDI の活用」の内容も含めて、選択した、WDI のデータについて、調べてみましょう。

## 準備 Setup

```{r}
Sys.setenv(LANG = "en")
library(tidyverse)
library(WDI)
```

```{r eval=FALSE}
dir.create("./data")
```

# プロジェクト１

## データ取得 Import data

GNI per capita, Atlas method (current US\$): NY.GNP.PCAP.CD ですから、変数名を　`gnppcap` 名前を、`df_gnppcap` に変えてみました。他の名前でも構いません。そのときは、適宜変更していってください。

```{r cache=TRUE}
df_gnppcap <- WDI(country = "all", 
              indicator = c(gnppcap = "NY.GNP.PCAP.CD"), 
              extra = TRUE)
```

## データ構造の確認

```{r}
head(df_gnppcap)
```

```{r}
str(df_gnppcap)
```

```{r}
summary(df_gnppcap) 
```

*国と、その iso2c を調べるのに役立ちます。*

```{r}
df_gnppcap %>% filter(region != "Aggregates") %>% distinct(country, iso2c)
```

*地域とその iso2c を調べるには、下のようなものが役に立ちます。*

```{r}
df_gnppcap %>% filter(region == "Aggregates") %>% distinct(country, iso2c)
```

### メモ：あれば

## 様々な視覚化によるデータ理解

### 特定の国の GNI per Capita の経年変化の折線グラフ

*日本にしてありますが、他の国や地域に変えてみてください。*

```{r}
df_gnppcap %>% filter(country == "Japan") %>% head()
```

*日本にしてありますが、他の国に変えてくださって構いません。コードをコピーして、いくつかの国について調べてみるのも良いでしょう。*

```{r}
df_gnppcap %>% filter(country == "Japan") %>%
  ggplot(aes(x = year, y = gnppcap)) + geom_line()
```

#### 特定の国の GNI per Capita の経年変化 について

*気づいたこと、わかったこと、疑問にわかったこと（幾つでも）*

-   

-   

-   

### 各年ごとのデータの数

```{r}
df_gnppcap %>% drop_na(gnppcap) %>% ggplot(aes(x = year)) + geom_bar()
```

### 特定の年の GNI per Capita の降順または昇順での表示

*GDP ではなく、GNP per Capita ですから、降順　`arrange(desc(gnppcap))`、昇順`arrange(gnppcap)`、地域ごとなど、調べてみてください。*

```{r}
df_gnppcap %>% filter(year == 2021, region != "Aggregates") %>% 
  drop_na(gnppcap) %>% arrange(desc(gnppcap))
```

```{r}
df_gnppcap %>% filter(year == 2021, region == "Aggregates") %>% 
  drop_na(gnppcap) %>% arrange(gnppcap) 
```

#### 特定の年の GNI per Capita の降順または昇順

*気づいたこと、わかったこと、疑問にわかったこと（幾つでも）*

-   

-   

-   

### いくつかの国、またはグループの GNI per Capita の経年変化

*iso2c の右の国のコードを入れ替えてみてください。*

```{r}
df_gnppcap %>% filter(iso2c %in% c("US", "CN", "JP", "DE", "IN", "GB", "FR")) %>%
  ggplot(aes(x = year, y = gnppcap, col = iso2c)) + geom_line()
```

*下はどんな地域でしょうか。調べたい国や地域の iso2c を入れてください。*

```{r}
df_gnppcap %>% filter(iso2c %in% c("XE", "XL", "XI", "XH","XQ","XO", "XP", "XF", "XJ")) %>%
  ggplot(aes(x = year, y = gnppcap, col = iso2c)) + geom_line()
```

#### いくつかの国、またはグループの GNI per Capita の経年変化

*気づいたこと、わかったこと、疑問にわかったこと（幾つでも）*

-   

-   

## 

### グループごとの国の数

*世界のGDP における割合に変えて、それぞれのグループに属する国の数を見てみましょう。*

*income level は、毎年変更しているわけではないので、現在の income level の国について、データがあるかという数です。人口とかがわかると面白いかもしれませんね。*

```{r}
df_gnppcap %>% drop_na(gnppcap) %>% filter(region != "Aggregates") %>%
  filter(income != "Not classified") %>%
  group_by(year, income) %>% summarize(number_of_countries = n()) %>% 
  mutate(level = factor(income, c("High income", "Upper middle income", "Lower middle income", "Low income"))) %>%
  ggplot(aes(x = year, y = number_of_countries, fill = level)) + 
  geom_col(col = "black", linewidth = 0.1)
```

```{r}
df_gnppcap %>% drop_na(gnppcap) %>% filter(region != "Aggregates") %>%
  filter(income != "Not classified") %>%
  group_by(year, income) %>% summarize(number_of_countries = n()) %>% 
  mutate(ratio = number_of_countries/sum(number_of_countries)) %>%
  mutate(level = factor(income, c("High income", "Upper middle income", "Lower middle income", "Low income"))) %>%
  ggplot(aes(x = year, y = ratio, fill = income)) + 
  geom_col(col = "black", linewidth = 0.1)  +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1))
```

### 特定の年の世界の国の GNI per Capita の分布

*年を変更したり、幅を変更したり、分ける個数を変更するなど。 `binwidth = 0.5` や、`bins = 20` を、`geom_histogram()` のかっこの中に入れます。*

```{r}
df_gnppcap %>% drop_na(gnppcap) %>% 
  filter(year == 2021) %>% filter(region  != "Aggregates") %>%
  ggplot(aes(gnppcap)) + geom_histogram()
```

```{r}
df_gnppcap %>% drop_na(gnppcap) %>% 
  filter(year == 2021) %>% filter(region  != "Aggregates") %>%
  ggplot(aes(gnppcap)) + geom_histogram() + scale_x_log10()
```

また、密度曲線に変えるには、`geom_density` を使います。

```{r}
df_gnppcap %>% drop_na(gnppcap) %>% 
  filter(year == 2021) %>% filter(region  != "Aggregates") %>%
  ggplot(aes(gnppcap)) + geom_density()
```

```{r}
df_gnppcap %>% drop_na(gnppcap) %>% 
  filter(year == 2021) %>% filter(region  != "Aggregates") %>%
  ggplot(aes(gnppcap)) + geom_density() + scale_x_log10()
```

*これは、2021年のデータですが、density の変化を見てみます。alpha の値は透明度です。*

*log10 scale と log10 をつけないものと、どちらがみやすいですか。*

```{r}
df_gnppcap %>% drop_na(gnppcap) %>% filter(region  != "Aggregates") %>%
  filter(year %in% c(1961, 1971, 1981, 1991, 2001, 2011, 2021)) %>%
  ggplot(aes(gnppcap, fill = factor(year))) + geom_density(alpha = 0.4)
```

```{r}
df_gnppcap %>% drop_na(gnppcap) %>% filter(region  != "Aggregates") %>%
  filter(year %in% c(1961, 1971, 1981, 1991, 2001, 2011, 2021)) %>%
  ggplot(aes(gnppcap, fill = factor(year))) + geom_density(alpha = 0.4) + scale_x_log10()
```

少しみにくいので、分けてみます。

```{r}
df_gnppcap %>% drop_na(gnppcap) %>% filter(region  != "Aggregates") %>%
  filter(year %in% c(1971, 1981, 1991, 2001, 2011, 2021)) %>%
  ggplot(aes(gnppcap, fill = factor(year))) + 
  geom_density() + scale_x_log10() + facet_wrap(~year)
```

#### 特定の年の GNI per Capita の分布について

*気づいたこと、わかったこと、疑問にわかったこと（幾つでも）*

-   

-   

-   

### グループごとの GNI per Capita の分布

*いくつかのグループごとに分布をみてみることも可能です。それには、Boxplot が有効です*。

```{r}
df_gnppcap %>% drop_na(gnppcap) %>% filter(region != "Aggregates") %>%
  drop_na(region) %>% filter(year %in% c(2021)) %>%
  ggplot(aes(gnppcap, region, fill = region)) + 
  geom_boxplot() + scale_x_log10() + labs(y = "") + 
  theme(legend.position = "none")
```

***収入の多寡による分類ごとの GNI per Capita の分布***

```{r}
df_gnppcap %>% drop_na(gnppcap) %>% filter(region != "Aggregates") %>%
  drop_na(income) %>% filter(year %in% c(2021)) %>%
  mutate(level = factor(income, c("High income", "Upper middle income", "Lower middle income", "Low income"))) %>%
  ggplot(aes(gnppcap, level, fill = income)) + 
  geom_boxplot() + scale_x_log10() + labs(y = "") + 
  theme(legend.position = "none")
```

### グループごとの GNI per Capita の分布について

*気づいたこと、わかったこと、疑問にわかったこと（幾つでも）*

-   

-   

-   

### 色分け地図

***世界地図の準備***

```{r cache=TRUE}
library(maps)
gnppcap_short <- df_gnppcap %>% filter(year == 2021, region != "Aggregates") %>%
  select(iso2c, gnppcap, income)
map_world <- map_data('world')
map_gnppcap <- map_world %>% 
  mutate(iso2c = iso.alpha(region, n=2)) %>% 
  left_join(gnppcap_short, by = "iso2c") 
head(map_gnppcap)
```

***Income Level による色分け地図***

```{r cache = TRUE}
map_gnppcap %>% mutate(income_level = factor(income, levels = c("High income", "Upper middle income", "Lower middle income", "Low income", "Not classified", NA))) %>%
  ggplot() +
  geom_map(aes(long, lat, map_id = region, fill = income_level), map = map_world, col = "black", size = 0.1) 
```

***GNI per Capita による色分け地図***

```{r cache = TRUE}
map_gnppcap %>% 
  ggplot() +
  geom_map(aes(x=long, y=lat, map_id = region, fill = gnppcap), map = map_world, col = "black", size = 0.1) 
```

### 色分け地図 について

*気づいたこと、わかったこと、疑問にわかったこと（幾つでも）*

-   

-   

-   

# プロジェクト2

## データ取得

## データ構造の確認

## 様々な視覚化によるデータ理解

*気づいたこと、わかったこと、疑問にわかったことの記述をお忘れなく。*

# プロジェクト3

## 調べたWDI の名称と、データコード

*WDI name と data code を最初に書いておいてください。*
