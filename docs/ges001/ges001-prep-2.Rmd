---
title: "GES 001 演習2"
author: "H. Suzuki"
date: "`r Sys.Date()`"
output:
  html_notebook: default
---

## 第2週

12/14(TH)　所得と富の不平等の現状１

　　　　　  所得と富の不平等の現状２

講義では、第2週、第3週とWorld Inequality report 2022を使って、所得と富の不平等について議論します。

12/19(TU)　Rでデータサイエンス2：人口の少子高齢化　 [[Main](https://ds-sl.github.io/intro2r/ges001/ges001-main.nb.html)]・[授業]

**People- Population dynamics**

総人口　Population, total：SP.POP.TOTL [[Link](https://data.worldbank.org/indicator/SP.POP.TOTL)]

出生率（千人）Birth rate, crude (per 1,000 people)：SP.DYN.CBRT.IN [[Link](https://data.worldbank.org/indicator/SP.DYN.CBRT.IN)]

死亡率（千人）Death rate, crude (per 1,000 people)：SP.DYN.CDRT.IN [[Link](https://data.worldbank.org/indicator/SP.DYN.CDRT.IN)]

若年労働人口率　Age dependency ratio, young (% of working-age population)：SP.POP.DPND.YG [[Link](https://data.worldbank.org/indicator/SP.POP.DPND.YG)]

高齢者労働人口率　Age dependency ratio, old (% of working-age population)：SP.POP.DPND.OL [[Link to Metadata](https://databank.worldbank.org/metadataglossary/health-nutrition-and-population-statistics/series/SP.POP.DPND.OL)]

## 内容

-   Package：tidyverse, WDI

-   データの取得

-   特定の行の取得：filter

-   折れ線グラフ

-   散布図

### トピック：人口の少子高齢化

```{r}
library(tidyverse)
library(WDI)
```

```{r eval = FALSE}
df_pop <- WDI(indicator = c(pop = "SP.POP.TOTL",
                            birth_rate = "SP.DYN.CBRT.IN",
                            death_rate = "SP.DYN.CDRT.IN",
                            young = "SP.POP.DPND.YG",
                            old = "SP.POP.DPND.OL"))
```

```{r eval = FALSE}
write_csv(df_pop, "data/pop.csv")
```

```{r}
df_pop <- read_csv("data/pop.csv")
```

```{r}
df_pop
```

それぞれ十分なデータがあるかチェック

```{r}
df_pop_long <- df_pop |> 
  pivot_longer(5:9, names_to = "name", values_to = "value")
```

```{r}
df_pop_long |> 
  group_by(year, name) |> drop_na(value) |>
  summarize(num = n()) |> arrange(desc(year))
```

```{r}
df_pop_long |> 
  group_by(year, name) |> drop_na(value) |>
  summarize(num = n()) |> 
  ggplot(aes(year, num, col = name)) + geom_line()
```

253から265の国・地域のデータがあり、問題なし

```{r eval = FALSE}
df_pop_extra <- WDI(indicator = c(pop = "SP.POP.TOTL",
                            birth_rate = "SP.DYN.CBRT.IN",
                            death_rate = "SP.DYN.CDRT.IN",
                            young = "SP.POP.DPND.YG",
                            old = "SP.POP.DPND.OL"), extra = TRUE)
```

```{r eval = FALSE}
write_csv(df_pop_extra, "data/pop_extra.csv")
```

```{r}
df_pop_extra <- read_csv("data/pop_extra.csv")
```

```{r}
glimpse(df_pop_extra)
```

```{r}
REGION <- df_pop_extra |> filter(region %in% c("Aggregates", NA)) |> distinct(iso2c) |> pull()
```

```{r}
df_pop %>% filter(iso2c %in% REGION) %>% distinct(country, iso2c)
```

```{r}
df_pop_extra |> distinct(country, iso2c)
```

```{r}
df_pop_extra |> filter(iso2c == "VN")
```

```{r}
length(REGION)
REGION <- REGION[REGION !="VN"]
length(REGION)
REGION
```

```{r}
df_pop |> filter(!(iso2c %in% REGION)) |> 
  distinct(country, iso2c) |> arrange(country)
```

### 総人口

総人口　Population, total：SP.POP.TOTL [[Link](https://data.worldbank.org/indicator/SP.POP.TOTL)]

```{r}
df_pop |> filter(country == "World") |> 
  ggplot(aes(year, pop)) + geom_line()
```

```{r}
df_pop |> filter(country == "Japan") |> 
  ggplot(aes(year, pop)) + geom_line()
```

```{r}
df_pop |> filter(!(iso2c %in% REGION)) |> filter(year == 2022) |> 
  arrange(desc(pop))
```

```{r}
df_pop |> filter(!(iso2c %in% REGION)) |> filter(year == 2022) |> 
  arrange(desc(pop)) |> slice_head(n=10)
```

```{r}
pop_top11 <- df_pop |> filter(!(iso2c %in% REGION)) |> filter(year == 2022) |> 
  arrange(desc(pop)) |> slice_head(n=11) |> pull(iso2c)
```

```{r}
df_pop |> filter(iso2c %in% pop_top11) |>
  ggplot(aes(year, pop, color = iso2c)) + geom_line()
```

```{r}
df_pop |> filter(iso2c %in% pop_top11) |> 
  filter(!(iso2c %in% c("CN", "IN"))) |> 
  ggplot(aes(year, pop, color = country)) + geom_line()
```

```{r}
df_pop |> filter(iso2c %in% pop_top11) |> 
  filter(!(iso2c %in% c("CN", "IN"))) |> 
  ggplot(aes(year, pop, color = factor(iso2c, levels = pop_top11))) + geom_line() + labs(color = "iso2c")
```

### 出生率と死亡率

出生率（千人）Birth rate, crude (per 1,000 people)：SP.DYN.CBRT.IN [[Link](https://data.worldbank.org/indicator/SP.DYN.CBRT.IN)]

死亡率（千人）Death rate, crude (per 1,000 people)：SP.DYN.CDRT.IN [[Link](https://data.worldbank.org/indicator/SP.DYN.CDRT.IN)]

```{r}

```
