---
title: "GES 001 演習5"
author: "H. Suzuki"
date: "2024年1月24日"
output:
  ioslides_presentation:
    widescreen: true
    df_print: paged
  html_document:
    df_print: paged
  html_notebook: default
---

## 準備

1.  （自分のPCまたは教室のPCに）ログイン

2.  ウェッブ・ブラウザー（Google Chrome など）を起動

    -   Moodle の GES001 経済と経済学のサイトから、このスライドのページを表示（リンク「Rでデータサイエンス」[**https://ds-sl.github.io/intro2r/ges001/**](https://ds-sl.github.io/intro2r/ges001/)）

3.  （別のタブまたは ウィンドウで）PositCloud にログイン[[Posit.cloud](https://posit.cloud/)]

    -   アカウントのない人はサイン・アップ [[共有プロジェクト](https://posit.cloud/content/5539763)] から、Save a Permanent Copy）

    -   RStudio を自分のコンピュータにインストールしている人は起動

4.  リンクの右上の Raw ボタンの右の Copy a raw file からコピーして演習用 R Markdown ファイルを作成（あとで再度解説します）[[Rmd](https://github.com/ds-sl/intro2r/blob/main/docs/ges001/poverty_rate.Rmd)]

## 第5週

01/18(TH)　南部アフリカ諸国の貧困と不平等に対する対策

　　　　　　COVID-19が貧困に与えた影響 　　　　

-   機会の不平等と成果の不平等が相互に関係し、長期にわたって持続している。

-   人生の初期に出現する不平等を最小化するための政策が重要である。

-   要因：教育、労働市場、失業率、男女間格差、土地所有権、などなど　　　

------------------------------------------------------------------------

01/23(TU)　Rでデータサイエンス5　 [[Main](https://ds-sl.github.io/intro2r/ges001/ges001-main.nb.html)]・[授業]　

**People-Education**

Government expenditure on education, total (% of GDP)：SE.XPD.TOTL.GD.ZS [[Link](https://data.worldbank.org/indicator/SE.XPD.TOTL.GD.ZS)]

General government expenditure on education (current, capital, and transfers) is expressed as a percentage of GDP. It includes expenditure funded by transfers from international sources to government. General government usually refers to local, regional and central governments.

教育に対する政府の一般支出（経常、資本、移転）は GDP の割合で表されます。これには、国際資金源から政府への送金によって資金提供された支出が含まれます。一般政府とは通常、地方自治体、地域政府、中央政府を指します。

------------------------------------------------------------------------

School enrollment, primary (% gross)：SE.PRM.ENRR [[Link](https://data.worldbank.org/indicator/SE.PRM.ENRR)]

Gross enrollment ratio is the ratio of total enrollment, regardless of age, to the population of the age group that officially corresponds to the level of education shown. Primary education provides children with basic reading, writing, and mathematics skills along with an elementary understanding of such subjects as history, geography, natural science, social science, art, and music.

総就学率は、年齢に関係なく、表示されている教育レベルに正式に対応する年齢層の人口に対する総就学者数の比率です。初等教育では、子供たちに基本的な読み書き、数学のスキルと、歴史、地理、自然科学、社会科学、芸術、音楽などの科目の初歩的な理解を提供します。

------------------------------------------------------------------------

School enrollment, secondary (% gross)：SE.SEC.ENRR [[Link](https://data.worldbank.org/indicator/SE.SEC.ENRR)]

Gross enrollment ratio is the ratio of total enrollment, regardless of age, to the population of the age group that officially corresponds to the level of education shown. Secondary education completes the provision of basic education that began at the primary level, and aims at laying the foundations for lifelong learning and human development, by offering more subject- or skill-oriented instruction using more specialized teachers.

総就学率は、年齢に関係なく、表示されている教育レベルに正式に対応する年齢層の人口に対する総就学者数の比率です。中等教育は、初等段階から始まった基礎教育の提供を完了し、より専門性の高い教師によるより教科や技能に特化した指導を行うことにより、生涯学習と人間形成の基礎を築くことを目的としています。

------------------------------------------------------------------------

School enrollment, tertiary (% gross)：SE.TER.ENRR [[Link](https://data.worldbank.org/indicator/SE.TER.ENRR)]

Gross enrollment ratio is the ratio of total enrollment, regardless of age, to the population of the age group that officially corresponds to the level of education shown. Tertiary education, whether or not to an advanced research qualification, normally requires, as a minimum condition of admission, the successful completion of education at the secondary level.

総就学率は、年齢に関係なく、表示されている教育レベルに正式に対応する年齢層の人口に対する総就学者数の比率です。高等教育では、高度な研究資格の有無にかかわらず、通常、入学の最低条件として中等教育レベルの教育を無事に修了することが求められます。

------------------------------------------------------------------------

**Health**

Mortality rate, under-5 (per 1,000 live births)：SH.DYN.MORT [[Link](https://databank.worldbank.org/metadataglossary/world-development-indicators/series/SH.DYN.MORT)]

Under-five mortality rate is the probability per 1,000 that a newborn baby will die before reaching age five, if subject to age-specific mortality rates of the specified year.

5 歳未満死亡率は、指定された年の年齢別死亡率が適用される場合に、新生児が 5 歳に達する前に死亡する 1,000 人あたりの確率です。

Incidence of HIV (% of uninfected population ages 15-49)：SH.HIV.INCD.ZS [[Link](https://data.worldbank.org/indicator/SH.HIV.INCD.ZS?locations=SZ)]

Number of new HIV infections among uninfected populations ages 15-49 expressed per 1,000 uninfected population in the year before the period.

期間の前の年間の非感染人口 1,000 人当たりの 15 ～ 49 歳の非感染集団における新規 HIV 感染者数。

------------------------------------------------------------------------

**Gender**

School enrollment, primary and secondary (gross), gender parity index (GPI)：SE.ENR.PRSC.FM.ZS [[Link](https://data.worldbank.org/indicator/SE.ENR.PRSC.FM.ZS)]

Gender parity index for gross enrollment ratio in primary and secondary education is the ratio of girls to boys enrolled at primary and secondary levels in public and private schools.

初等中等教育における総就学率の男女平等指数は、公立および私立学校の初等および中等教育レベルに在籍する女子と男子の比率です。

Ratio of female to male labor force participation rate (%) (modeled ILO estimate)：SL.TLF.CACT.FM.ZS [[Link](https://data.worldbank.org/indicator/SL.TLF.CACT.FM.ZS)]

Labor force participation rate is the proportion of the population ages 15 and older that is economically active: all people who supply labor for the production of goods and services during a specified period. Ratio of female to male labor force participation rate is calculated by dividing female labor force participation rate by male labor force participation rate and multiplying by 100.

労働参加率とは、経済的に活動している 15 歳以上の人口の割合であり、指定された期間に商品やサービスの生産に労働力を供給するすべての人々を指します。女性労働力率と男性労働力率の比率は、女性労働力率を男性労働力率で割って100を乗じて算出します。

------------------------------------------------------------------------

**Labor**

Unemployment, female (% of female labor force) (modeled ILO estimate)：SL.UEM.TOTL.FE.ZS [[Link](https://data.worldbank.org/indicator/SL.UEM.TOTL.FE.ZS)]

Unemployment refers to the share of the labor force that is without work but available for and seeking employment.

失業率とは、仕事はなくても職に就くことができ、求職している労働力の割合を指します。

Unemployment, male (% of male labor force) (modeled ILO estimate)：SL.UEM.TOTL.MA.ZS [[Link](https://data.worldbank.org/indicator/SL.UEM.TOTL.MA.ZS)]

Unemployment refers to the share of the labor force that is without work but available for and seeking employment.

失業率とは、仕事はなくても職に就くことができ、求職している労働力の割合を指します。

------------------------------------------------------------------------

#### Global Link - Aid dependency

Net official development assistance and official aid received (current US\$) DT.ODA.ALLD.CD [[Link](https://data.worldbank.org/indicator/DT.ODA.ALLD.CD)]

Net official development assistance (ODA) consists of disbursements of loans made on concessional terms (net of repayments of principal) and grants by official agencies of the members of the Development Assistance Committee (DAC), by multilateral institutions, and by non-DAC countries to promote economic development and welfare in countries and territories in the DAC list of ODA recipients. It includes loans with a grant element of at least 25 percent (calculated at a rate of discount of 10 percent). Net official aid refers to aid flows (net of repayments) from official donors to countries and territories in part II of the DAC list of recipients: more advanced countries of Central and Eastern Europe, the countries of the former Soviet Union, and certain advanced developing countries and territories. Official aid is provided under terms and conditions similar to those for ODA. Part II of the DAC List was abolished in 2005. The collection of data on official aid and other resource flows to Part II countries ended with 2004 data. Data are in current U.S. dollars.

政府開発援助（ODA）の純額は、開発援助委員会（DAC）メンバーの公的機関、多国間機関、DAC非加盟国による、譲許的条件（元本返済を除く）で行われた融資の実行と助成金で構成されます。 DAC の ODA 受領者リストに含まれる国および地域の経済発展と福祉を促進する。これには、少なくとも 25 パーセント（割引率 10 パーセントで計算）の補助金要素を持つローンが含まれます。純公的援助とは、公的ドナーからDACの受取人リストのパートIIにある国および地域への援助の流れ（返済額を差し引いた額）を指します：中央および東ヨーロッパのより先進国、旧ソ連諸国、および一部の先進途上国国と地域。公的援助は、ODA と同様の条件で提供されます。DAC リストのパート II は 2005 年に廃止されました。パート II 諸国への公的援助およびその他の資源の流れに関するデータの収集は 2004 年のデータで終了しました。データは現在の米ドルで表示されます。

```{r echo = FALSE}
library(tidyverse)
library(WDI)
```

# 演習 1月24日（火）

## 内容

-   *Poverty headcount ratio at \$6.85 a day (2017 PPP) (% of population)：SI.POV.UMIC [[Link](https://data.worldbank.org/indicator/SI.POV.UMIC)]*

-   Government expenditure on education, total (% of GDP)：SE.XPD.TOTL.GD.ZS [[Link](https://data.worldbank.org/indicator/SE.XPD.TOTL.GD.ZS)]

-   School enrollment, primary (% gross)：SE.PRM.ENRR [[Link](https://data.worldbank.org/indicator/SE.PRM.ENRR)]

-   School enrollment, secondary (% gross)：SE.SEC.ENRR [[Link](https://data.worldbank.org/indicator/SE.SEC.ENRR)]

-   School enrollment, tertiary (% gross)：SE.TER.ENRR [[Link](https://data.worldbank.org/indicator/SE.TER.ENRR)]

------------------------------------------------------------------------

-   Mortality rate, under-5 (per 1,000 live births)：SH.DYN.MORT [[Link](https://databank.worldbank.org/metadataglossary/world-development-indicators/series/SH.DYN.MORT)]

-   Incidence of HIV (% of uninfected population ages 15-49)：SH.HIV.INCD.ZS [[Link](https://data.worldbank.org/indicator/SH.HIV.INCD.ZS?locations=SZ)]

-   School enrollment, primary and secondary (gross), gender parity index (GPI)：SE.ENR.PRSC.FM.ZS [[Link](https://data.worldbank.org/indicator/SE.ENR.PRSC.FM.ZS)]

-   Ratio of female to male labor force participation rate (%) (modeled ILO estimate)：SL.TLF.CACT.FM.ZS [[Link](https://data.worldbank.org/indicator/SL.TLF.CACT.FM.ZS)]

-   Unemployment, female (% of female labor force) (modeled ILO estimate)：SL.UEM.TOTL.FE.ZS [[Link](https://data.worldbank.org/indicator/SL.UEM.TOTL.FE.ZS)]

-   Unemployment, male (% of male labor force) (modeled ILO estimate)：SL.UEM.TOTL.MA.ZS [[Link](https://data.worldbank.org/indicator/SL.UEM.TOTL.MA.ZS)]

-   Net official development assistance and official aid received (current US\$) DT.ODA.ALLD.CD [[Link](https://data.worldbank.org/indicator/DT.ODA.ALLD.CD)]

<!-- ## 復習 -->

<!-- 貧困は、どのような尺度で測るのだろうか。 -->

<!-- ### 一人当たりの購買力平価（Purchasing Power Parities）による国内総生産（Gross Domestic Product） -->

<!-- -   GDP per capita, PPP (constant 2017 international \$): NY.GDP.PCAP.PP.KD [[Link](https://data.worldbank.org/indicator/NY.GDP.PCAP.PP.KD)] -->

<!-- -   12/13 極度に貧しい！？ [[R Notebook](https://ds-sl.github.io/intro2r/ges001/poverty.nb.html)], [[Rmd](https://github.com/ds-sl/intro2r/blob/main/docs/ges001/poverty.Rmd)] -->

<!-- -   国ごとの所得の平均のようなものはわかるが、極度の貧困の人がどの程度いるのかはわからない。 -->

<!-- ------------------------------------------------------------------------ -->

<!-- ### 人口動態（demography） -->

<!-- -   人口のデータ（総人口、出生率、死亡率、若年者扶養率、高齢者扶養率） -->

<!-- -   12/20 人口動態（demography）[[R Notebook](https://ds-sl.github.io/intro2r/ges001/demography.nb.html)], [[Rmd](https://github.com/ds-sl/intro2r/blob/main/docs/ges001/demography.Rmd)] -->

<!-- -   人口データは基本的で、国の値から個人の値を求めたり、他の国と比較しやすい割合から実際の数を求めるなどに必須 -->

<!-- ------------------------------------------------------------------------ -->

<!-- ### ジニ指数および所得分布 -->

<!-- -   ジニ指数（Gini）, 所得の下位10%, 20%, 20%-40%, 40%-60%, 60%-80%, 80%以上, 90%以上 -->

<!-- -   1/9 ジニって何！？ [[R Notebook](https://ds-sl.github.io/intro2r/ges001/what_is_gini.nb.html)], [[Rmd](https://github.com/ds-sl/intro2r/blob/main/docs/ges001/what_is_gini.Rmd)] -->

<!-- -   1/9 ジニ指数と所得分布 [[R Notebook](https://ds-sl.github.io/intro2r/ges001/gini.nb.html)], [[Rmd](https://github.com/ds-sl/intro2r/blob/main/docs/ges001/gini.Rmd)]　（参考1/参考2付 [[R Notebook](https://ds-sl.github.io/intro2r/ges001/gini_long.nb.html)]） -->

<!-- -   国の中での所得分布を見、かつ所得分配の公平さを一つの指標（ジニ指数）で表すことにより、比較も可能になったが、極度に貧困なひとがどのぐらいいるのかはわからない。 -->

<!-- ## 貧困者率 -->

<!-- -   生活するための基本的ニーズを賄うために必要とそれぞれの国が考える基準を満たしていない人口の割合 -->

<!--     -   Poverty headcount ratio at national poverty lines (% of population)：SI.POV.NAHC [[Link](https://data.worldbank.org/indicator/SI.POV.NAHC)] -->

<!--     -   日本は？ [[Wikipedia](https://ja.wikipedia.org/wiki/%E6%97%A5%E6%9C%AC%E3%81%AE%E8%B2%A7%E5%9B%B0)] -->

<!-- -   \$2.15/日 (\$65.4/月, 785/年), \$3.65（\$111.0/月, \$1,332/年）, \$6.85（\$208.4/月, \$2,500/年） -->

<!--     -   Poverty headcount ratio at \$2.15 a day (2017 PPP) (% of population)：SI.POV.DDAY [[Link](https://data.worldbank.org/indicator/SI.POV.DDAY)] -->

<!--     -   Poverty headcount ratio at \$3.65 a day (2017 PPP) (% of population)：SI.POV.LMIC [[Link](https://data.worldbank.org/indicator/SI.POV.LMIC)] -->

```         
<!-- -   Poverty headcount ratio at \$6.85 a day (2017 PPP) (% of population)：SI.POV.UMIC [[Link](https://data.worldbank.org/indicator/SI.POV.UMIC)] -->
```

------------------------------------------------------------------------

### 準備

```{r}
library(tidyverse)
library(WDI)
```

------------------------------------------------------------------------

### データの読み込み（importing）

```{r eval = FALSE}
df_poverty_inequality <- WDI(
  indicator = c(gini = "SI.POV.GINI",
                under_6.85 = "SI.POV.UMIC",
                ed_exp = "SE.XPD.TOTL.GD.ZS",
                primary = "SE.PRM.ENRR",
                secondary = "SE.SEC.ENRR",
                tertiary = "SE.TER.ENRR",
                under5 = "SH.DYN.MORT",
                new_hiv = "SH.HIV.INCD.ZS",
                school_gpi = "SE.ENR.PRSC.FM.ZS",
                job_gpi = "SL.TLF.CACT.FM.ZS",
                female_unemploy = "SL.UEM.TOTL.FE.ZS",
                male_unemploy = "SL.UEM.TOTL.FE.ZS",
                oda = "DT.ODA.ALLD.CD"), extra = TRUE)
```

#### 保存と読み込み

２回目からは、`data` から読み込めるようにしておきます。

***最初の１回目は、かならず実行してください。***

```{r eval = FALSE}
write_csv(df_poverty_inequality, "data/poverty_inequality.csv")
```

```{r}
df_poverty_inequality <- read_csv("data/poverty_inequality.csv")
```

```{r}
REGION <- c("1A", "1W", "4E", "7E", "8S", "B8", "EU", "F1", "OE", "S1", 
"S2", "S3", "S4", "T2", "T3", "T4", "T5", "T6", "T7", "V1", "V2", 
"V3", "V4", "XC", "XD", "XE", "XF", "XG", "XH", "XI", "XJ", "XL", 
"XM", "XN", "XO", "XP", "XQ", "XT", "XU", "XY", "Z4", "Z7", "ZF", 
"ZG", "ZH", "ZI", "ZJ", "ZQ", "ZT")
```

### データを見てみよう (viewing)

```{r}
df_poverty_inequality |> filter(iso2c %in% REGION) |> distinct(country, iso2c)
```

```{r}
df_poverty_inequality |> filter(!(iso2c %in% REGION)) |> distinct(country, iso2c)
```

### 変数の選択（selecting）

```{r}
df_pov_ineq <- df_poverty_inequality |> select(country, iso2c, year, gini:oda, region, income, lending)
```

### 変形（Wide to Long Data）

いくつもの指標を同時にいくつか選択し比較したいので、一つの列（変数）にならべた、縦長データ（long data）も作成しておきます。

`pivot_longer(gini:oda)`

ここでは、`ratio` から `under_6.85` を、`level` という名前の列にならべ、値を `value` という列に並べるようにしてあります。

確認するときは、value が NA のものは除き、country と、iso2c と、level と value の部分だけ取り出して確認しています。

```{r}
df_pov_ineq_long <- df_pov_ineq |> pivot_longer(gini:oda)
```

### 年毎のデータの数の確認（number of data in each year）

```{r}
df_pov_ineq_long |> drop_na(value) |> 
  group_by(year, name) |> summarize(n = n()) |> arrange(desc(year))
```

------------------------------------------------------------------------

### 変数同士の相関関係 - 相関係数

```{r}
df_pov_ineq |> drop_na(gini:oda) |> select(gini:oda)
```

------------------------------------------------------------------------

```{r}
cor(cars$speed,cars$dist)
```

```{r fig.height=3, fig.width=7}
cars |> ggplot(aes(speed, dist)) + geom_point() + 
  geom_smooth(formula = 'y~x',method = "lm", se=FALSE)
```

**相関係数：**直線の傾きが正なら正、負なら負、直線に近い程、1 または-1 に近い

------------------------------------------------------------------------

### 変数相互の相関係数を一度に求める

```{r echo=TRUE, eval=FALSE}
df_pov_ineq |> drop_na(gini:oda) |> select(gini:oda) |> cor() |> 
  round(digits = 2) |> as.data.frame()
```

------------------------------------------------------------------------

```{r echo=FALSE}
df_pov_ineq |> drop_na(gini:oda) |> select(gini:oda) |> cor() |> 
  round(digits = 2) |> as.data.frame()
```

```{r}
df_pov_ineq |> drop_na(gini, primary) |>
  ggplot(aes(gini, primary)) + geom_point() + 
  geom_smooth(method = "lm", se = FALSE)
```

```{r}
df_pov_ineq |> drop_na(gini, tertiary) |>
  ggplot(aes(gini, tertiary)) + geom_point() + 
  geom_smooth(method = "lm", se = FALSE)
```

```{r}
df_pov_ineq |> drop_na(under_6.85, tertiary) |>
  ggplot(aes(under_6.85, tertiary)) + geom_point() + 
  geom_smooth(method = "lm", se = FALSE)
```

```{r}
df_pov_ineq |> drop_na(under_6.85, under5) |>
  ggplot(aes(under_6.85, under5)) + geom_point() + 
  geom_smooth(method = "lm", se = FALSE)
```

<!-- ```{r} -->

<!-- df_education_long |>  -->

<!--   group_by(year, name) |> drop_na(value) |> -->

<!--   summarize(num = n()) |>  -->

<!--   ggplot(aes(year, num, col = name)) + geom_line() + -->

<!--   labs(title = "各指標の年毎のデータ数", y = "データ数", x = "年") -->

<!-- ``` -->

<!-- World Development Indicators: [[Link](https://datacatalog.worldbank.org/search/dataset/0037712/World-Development-Indicators)] -->

<!-- ### World (1W), Sub-Saharan Africa　(excluding high income) (ZF), and Sub-Saharan Africa (ZG) -->

<!-- ```{r} -->

<!-- df_education_long |>  -->

<!--   filter(name %in% c("primary", "secondary", "tertiary")) |> -->

<!--   filter(iso2c %in% c("1W", "ZF", "ZG")) |> drop_na(value) |> -->

<!--   ggplot(aes(year, value, col = name, linetype = iso2c)) + geom_line() -->

<!-- ``` -->

<!-- ```{r} -->

<!-- df_education |> filter(year == 2020) |>  -->

<!--   select(education, primary, secondary, tertiary) |>  -->

<!--   drop_na() |> cor() -->

<!-- ``` -->

<!-- ```{r} -->

<!-- df_education |> filter(country == "Japan") |> arrange(desc(year)) -->

<!-- ``` -->

<!-- ```{r} -->

<!-- df_education |> filter(region != "Aggregates") |> -->

<!--   filter(year == 2020) |> -->

<!--   drop_na(education) |>  -->

<!--   ggplot(aes(education, fill = region)) + geom_histogram(col = "black", linewidth = 0.1, binwidth = 1) + -->

<!--   geom_vline(xintercept = 3.416981) + theme(legend.position = "top") -->

<!-- ``` -->

<!-- ```{r} -->

<!-- df_education |>  -->

<!--   filter(country %in% c("World", "Japan", "South Africa")) |> -->

<!--   drop_na(education) |> -->

<!--   ggplot(aes(year, education, col = country)) + geom_line()  -->

<!-- ``` -->

<!-- ```{r} -->

<!-- df_education |>  -->

<!--   filter(country %in% c("World", "Japan", "Korea, Rep.", "China")) |> -->

<!--   drop_na(education) |> -->

<!--   ggplot(aes(year, education, col = country)) + geom_line()  -->

<!-- ``` -->

<!-- ## ファイルリンク -->

<!-- -   PositCloud 共有リンク：<https://posit.cloud/content/5539763> -->

<!--     -   貧困率 - Poverty Rate（poverty_rate.Rmd） [[リンク](https://ds-sl.github.io/intro2r/ges001/poverty_rate.nb.html)], [[Rmd](https://github.com/ds-sl/intro2r/blob/main/docs/ges001/poverty_rate.Rmd)] -->

<!--         -   より詳細なもの：poverty_rate_long.Rmd [[リンク](https://ds-sl.github.io/intro2r/ges001/poverty_rate_long.nb.html)], [[Rmd](https://github.com/ds-sl/intro2r/blob/main/docs/ges001/poverty_rate_long.Rmd)] -->

<!--             -   PositCloud では、メモリーオーバー -->

<!-- -   R Notebook のソースファイル（Rmd）を取得する三つの方法 -->

<!--     1.  **Rmd のリンクをクリックし Raw の横の Copy a raw file からコピー、新規 RMarkdown ファイルを PositCloud または RStudio のプロジェクト内に作成しペースト** -->

<!--     2.  PositCloud 共有リンクの ges001 のディレクトリ（フォルダから探す）ファイルを開き、全体を選択してコピーし、自分の RStudio または、PositCloud のファイルで、RMarkdown ファイルを新規作成しペースト -->

<!--     3.  リンクを開き、右上の Code から、Rmd ファイルをダウンロードとし、それを、自分の RStudio または、PositCloud のプロジェクトに移動（Upload） -->

<!-- ## 作業手順とまとめ -->

<!-- -   パッケージ（Package）の利用： -->

<!--     -   インストール（installation）：Tools \> Install Packages -->

<!--     -   ロード（load）`library(tidyverse); library(WDI); library(showtext); library(DescTools)` -->

<!-- -   データの取得：`WDI(indicator = c(pop = "SP.POP.TOTL"))` -->

<!--     -   `WDI(indicator = c(ratio = "SI.POV.NAHC", under_2.15 = "SI.POV.DDAY", under_3.65 = "SI.POV.LMIC", under_6.85 = "SI.POV.UMIC"), extra = TRUE)` -->

<!--     -   data に書き出し、そこから読み込むと良い。 -->

<!--         -   `write_csv(df_poverty_rate, "data/poverty_rate.csv")` -->

<!--         -   `read_csv("data/poverty_rate.csv")` -->

<!-- -   データを見る：`df_poverty_rate` , `head(df_poverty_rate)`, `str(df_poverty_rate)` -->

<!-- ------------------------------------------------------------------------ -->

<!-- ### データの変形 -->

<!-- -   変数の選択：`select(country, year, ratio, under_2.15, under_3.65, under_6.85, region)` -->

<!-- -   データの変形（Long data）：`pivot_longer(ratio:under_6.85, names_to = "level", values_to = "value")` -->

<!-- -   特定の行の取得：`filter(), drop_na(), distinct()` -->

<!-- -   行の順番の並び替え：`arrange(desc(year))` -->

<!-- -   グループ分け：`group_by()` , `group_by(year, level) |> summarize(n = n())` -->

<!-- ------------------------------------------------------------------------ -->

<!-- ### 可視化 -->

<!-- -   折れ線グラフ -->

<!--     -   `ggplot(aes(x = year, y = under_2.15) + geom_line()` -->

<!--     -   `ggplot(aes(x = year, y = under_2.15, col = country) + geom_line()` -->

<!-- -   ヒストグラム（度数分布） -->

<!--     -   `ggplot(aes(under_2.15, fill = region)) + geom_histogram(bins = 15)` -->

<!-- -   箱ひげ図（Boxplot） -->

<!--     -   `ggplot(aes(under_2.15, region, fill = region)) + geom_boxplot()` -->

<!-- ------------------------------------------------------------------------ -->

<!-- -   棒グラフ -->

<!--     -   `ggplot(aes(year)) + geom_bar()` -->

<!--     -   `ggplot(aes(levels, value)) + geom_col()` -->

<!--     -   `ggplot(aes(x = levels, y = value, fill = country)) + geom_col(position = "dodge")` -->

<!--     -   `ggplot(aes(x = gini, fill = region)) + geom_histogram()` -->

<!-- -   散布図（+回帰直線） -->

<!--     -   `ggplot(aes(gini, 90-100)) + geom_point()` -->

<!--     -   `ggplot(aes(gini, 80-100)) + geom_point() + geom_smooth(formula = 'y ~ x', method = "lm")` -->

<!-- ***常に、考察、気づいたことを、記録してください。*** -->

## 課題

以下の指標の中から、一つを選択して、データの概要（description）を記録し、データを WDI で取得し、以下の分析をする。

1.  各年毎のデータの数の棒グラフ
2.  日本のデータの年の降順での表示
3.  経年変化を表す折れ線グラフ
    a.  日本
    b.  南部アフリカ関税同盟の５カ国
    c.  選択したいくつかの国
4.  データが十分ある最近の年の値のヒストグラム
5.  データが十分ある最近の年の値の10カ国の値の棒グラフ
    a.  値が大きい方から
    b.  値が小さい方から

それぞれについて考察（気づいたこと、疑問など）を記す

**2023.1.25. 23:59** までに Moodle の演習の課題ボックスに提出したものについては、なるべく、早く見て、フィードバックを書きます。それ以降に提出されたものも見ますが、フィードバックは遅くなると思ってください。

### データ

1.  Government expenditure on education, total (% of GDP)：SE.XPD.TOTL.GD.ZS [[Link](https://data.worldbank.org/indicator/SE.XPD.TOTL.GD.ZS)] 変数名：`ed_exp`

2.  School enrollment, primary (% gross)：SE.PRM.ENRR [[Link](https://data.worldbank.org/indicator/SE.PRM.ENRR)] 変数名：`primary`

3.  School enrollment, secondary (% gross)：SE.SEC.ENRR [[Link](https://data.worldbank.org/indicator/SE.SEC.ENRR)] 変数名：`secondary`

4.  School enrollment, tertiary (% gross)：SE.TER.ENRR [[Link](https://data.worldbank.org/indicator/SE.TER.ENRR)] 変数名：`tertiary`

5.  Mortality rate, under-5 (per 1,000 live births)：SH.DYN.MORT [[Link](https://databank.worldbank.org/metadataglossary/world-development-indicators/series/SH.DYN.MORT)] 変数名：`under5`

6.  Incidence of HIV (% of uninfected population ages 15-49)：SH.HIV.INCD.ZS [[Link](https://data.worldbank.org/indicator/SH.HIV.INCD.ZS?locations=SZ)] 変数名：`new_hiv`

7.  School enrollment, primary and secondary (gross), gender parity index (GPI)：SE.ENR.PRSC.FM.ZS [[Link](https://data.worldbank.org/indicator/SE.ENR.PRSC.FM.ZS)] 変数名：`school_gpi`

8.  Ratio of female to male labor force participation rate (%) (modeled ILO estimate)：SL.TLF.CACT.FM.ZS [[Link](https://data.worldbank.org/indicator/SL.TLF.CACT.FM.ZS)] 変数名：`job_gpi`

9.  Unemployment, female (% of female labor force) (modeled ILO estimate)：SL.UEM.TOTL.FE.ZS [[Link](https://data.worldbank.org/indicator/SL.UEM.TOTL.FE.ZS)] 変数名：`female_unemploy`

10. Unemployment, male (% of male labor force) (modeled ILO estimate)：SL.UEM.TOTL.MA.ZS [[Link](https://data.worldbank.org/indicator/SL.UEM.TOTL.MA.ZS)] 変数名：`male_unemploy`

11. Net official development assistance and official aid received (current US\$) DT.ODA.ALLD.CD [[Link](https://data.worldbank.org/indicator/DT.ODA.ALLD.CD)] 変数名：`oda`

# 国の教育に関する支出

> 概要：国内総生産（GDP）に対する、国の教育に関する支出（Government expenditure on education, total (% of GDP)）のデータの分析を行う

## データ

Government expenditure on education, total (% of GDP)：SE.XPD.TOTL.GD.ZS [[Link](https://data.worldbank.org/indicator/SE.XPD.TOTL.GD.ZS)]

### データ情報

-   データ名：

-   データコード：

-   変数名：

-   概要：

### データの取得

#### 準備

```{r}
library(tidyverse)
library(WDI)
```

WDI パッケージを使って、直接データをダウンロードし、変数名を、`ed_exp` に指定。

```{r eval = FALSE}
df_ed_exp <- WDI(indicator = c(ed_exp = "SE.XPD.TOTL.GD.ZS"))
```

```{r eval = FALSE}
write_csv(df_ed_exp, "data/ed_exp.csv")
```

```{r}
df_ed_exp <- read_csv("data/ed_exp.csv")
```

### データの確認

```{r}
df_ed_exp
```

```{r}
str(df_ed_exp)
```

```{r}
REGION <- c("1A", "1W", "4E", "7E", "8S", "B8", "EU", "F1", "OE", "S1", 
"S2", "S3", "S4", "T2", "T3", "T4", "T5", "T6", "T7", "V1", "V2", 
"V3", "V4", "XC", "XD", "XE", "XF", "XG", "XH", "XI", "XJ", "XL", 
"XM", "XN", "XO", "XP", "XQ", "XT", "XU", "XY", "Z4", "Z7", "ZF", 
"ZG", "ZH", "ZI", "ZJ", "ZQ", "ZT")
```

```{r}
df_ed_exp |> filter(iso2c %in% REGION) |> distinct(country, iso2c)
```

```{r}
df_ed_exp |> filter(!(iso2c %in% REGION)) |> distinct(country, iso2c)
```

### 分析する国のリスト

#### **南部アフリカ関税同盟** The Southern African Customs Union (SACU)

```{r}
SOUTH_AFRICA_FIVE <- c("South Africa", "Namibia", "Eswatini", "Botswana", "Lesotho")
```

#### ラテンアメリカでジニ指数が大きい４カ国

```{r}
CHOSEN_GINI_COUNTRIES <- c("Suriname", "Belize", "Brazil", "Colombia")
```

## 分析

### 1. 各年毎のデータの数の棒グラフ

```{r}
df_ed_exp |> drop_na(ed_exp) |> filter(!(iso2c %in% REGION)) |>
  ggplot(aes(year)) + geom_bar()
```

## 視覚化

### 2. 日本の教育費（% of GDP）

```{r}
df_ed_exp |> filter(country == "Japan") |> 
  drop_na(ed_exp) |> arrange(desc(year))
```

### 3. 経年変化

#### a. 日本

```{r}
df_ed_exp |> filter(country == "Japan") |> drop_na(ed_exp) |>
  ggplot(aes(year, ed_exp)) + geom_line()
```

**気づいたこと・疑問**

-   1970年代の急激な上昇、1990年ごろの急激な現象は、何が原因なのだろう。

-   2014年ごろから減少、2018年ごろから増加、2020年から2021年は減少。

#### b. 南部アフリカ関税同盟

```{r}
df_ed_exp |> filter(country %in% SOUTH_AFRICA_FIVE) |> drop_na(ed_exp) |>
  ggplot(aes(year, ed_exp)) + geom_line(aes(col = country))
```

**参考：平均的な値を曲線で表すことも可能です。loess を使うと滑らかな曲線で近似してくれます。**

```{r}
df_ed_exp |> filter(country %in% SOUTH_AFRICA_FIVE) |> drop_na(ed_exp) |>
  ggplot(aes(year, ed_exp)) + geom_line(aes(col = country)) +
  geom_smooth(formula = 'y~x', method = "loess", se = FALSE)
```

**気づいたこと・疑問**

-   平均で見ると、上昇してきており、7% 程度という大きな割合になっている。

#### c. ラテンアメリカ４カ国

```{r}
df_ed_exp |> filter(country %in% CHOSEN_GINI_COUNTRIES) |> drop_na(ed_exp) |>
  ggplot(aes(year, ed_exp)) + geom_line(aes(col = country))
```

**参考：平均的な値を曲線で表すことも可能です。loess を使うと滑らかな曲線で近似してくれます。**

```{r}
df_ed_exp |> filter(country %in% CHOSEN_GINI_COUNTRIES) |> drop_na(ed_exp) |>
  ggplot(aes(year, ed_exp)) + geom_line(aes(col = country)) +
  geom_smooth(formula = 'y~x', method = "loess", se = FALSE)
```

### 分布

データの数から、まずは、2020年について見てみる。

```{r}
df_ed_exp |> filter(year == 2020) |> filter(!(country %in% REGION))|>
  drop_na(ed_exp) |>
  ggplot(aes(ed_exp)) + geom_histogram(binwidth = 1)
```

**参考：**SACU の５カ国の値を縦線で書き込むには下のようにします。

```{r}
df_ed_exp |> filter(year == 2020) |> filter(country %in% SOUTH_AFRICA_FIVE) 
```

**参考：日本と**SACU の５カ国の値を縦線で書き込むには下のようにします。

```{r}
JP <- 3.416981
SAF <- df_ed_exp |> filter(year == 2020) |> filter(country %in% SOUTH_AFRICA_FIVE) |> pull(ed_exp)
df_ed_exp |> filter(year == 2020) |> filter(!(country %in% REGION))|>
  drop_na(ed_exp) |>
  ggplot() + geom_histogram(aes(ed_exp), binwidth = 1) +
  geom_vline(xintercept = SAF, col = "red") + geom_vline(xintercept = JP, col = "blue") +labs(title = "2020年の教育費の対GDP百分率", subtitle = "日本：青、SACU：赤")
```

### データが十分ある最近の年の値の10カ国の値の棒グラフ

#### a. 値が大きい方から

```{r}
df_ed_exp |> filter(year == 2020) |> drop_na(ed_exp) |> 
  filter(!(iso2c %in% REGION))|>
  arrange(desc(ed_exp)) |> head(10) |> 
  ggplot(aes(fct_reorder(country, ed_exp), ed_exp)) + geom_col() + 
  coord_flip() + labs(title = "Top 10 Countries", x = "country", y = "Government expenditure on education, total (% of GDP)")
```

#### b. 値が小さい方から

```{r}
df_ed_exp |> filter(year == 2020) |> drop_na(ed_exp) |> 
  filter(!(iso2c %in% REGION))|>
  arrange(ed_exp) |> head(10) |> 
  ggplot(aes(fct_rev(fct_reorder(country, ed_exp)), ed_exp)) + geom_col() + 
  coord_flip() + labs(title = "Lowest 10 Countries", x = "country", y = "Government expenditure on education, total (% of GDP)")
```

### 演習の内容と課題

基本的には、PositCloud（<https://posit.cloud/>）を使って実習

-   探索的データ分析（EDA） -
    -   練習と一つ目の課題（w5eda.Rmd） [[リンク](https://ds-sl.github.io/intro2r/ges001/w5eda.nb.html)], [[Rmd](https://github.com/ds-sl/intro2r/blob/main/docs/ges001/w5eda.Rmd)]
    -   二つ目以降の課題：w5eda1.Rmd [[リンク](https://ds-sl.github.io/intro2r/ges001/w5eda1.nb.html)], [[Rmd](https://github.com/ds-sl/intro2r/blob/main/docs/ges001/w5eda1.Rmd)]
-   課題：**2023.1.25. 23:59** までに Moodle の演習の課題ボックスに提出したものについては、なるべく、早く見て、フィードバックを書きます。それ以降に提出されたものも見ますが、フィードバックは遅くなると思ってください。

## 参考文献

1.  「みんなのデータサイエンス - Data Science for All」[[はじめてのデータサイエンス](https://icu-hsuzuki.github.io/ds4aj/first-example.html#first-example)]

    -   導入として、GDP（国内総生産）のデータを使って説明しています。

2.  Posit Recipes（旧 Posit Primers）: The Basics 対話型の演習サイトの最初 [[Link](https://posit.cloud/learn/recipes)]

3.  Posit Cheat Sheet. 早見表です。印刷して使うために、PDF も提供しています。[[Site Link](https://rstudio.github.io/cheatsheets/)]

4.  DataCamp Cheat Sheet: Tidyverse for Biginners. データサイエンスの教育をしている会社の早見表の一つです。基本が簡単にまとまっています。[[Link](https://images.datacamp.com/image/upload/v1676302697/Marketing/Blog/Tidyverse_Cheat_Sheet.pdf)]
