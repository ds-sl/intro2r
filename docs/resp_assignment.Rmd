---
title: "ECO232 R で始めるデータサインエス課題：応答"
author: "Hiroshi Suzuki（鈴木寛）"
date: "`r Sys.Date()`"
output:
  html_notebook: 
    number_sections: yes
---

# はじめに　

まずは、謝るところから始めないといけません。テンプレートをそのまま、使うと、エラーが出てしまいます。問題なかったかたもおられると思いますが、それは、今回の授業の作業をしたプロジェイウトに続けて、作業をしたからだと思われます。スクリプトの中で、`wdi_cache` をもう一度読み込むことを忘れていました。それが、どこに保存されているかも確認していなかったので、テンプレートには、最初の、setup と書いてある、コードチャンクの次に、`wdi_cache <- WDIcache()` をしておかないといけませんでした。それを追加した上で、コメントを書きます。

気づいて、しっかり読み込んでくださった方もおられました。申し訳ありません。

<!-- 1. タイトル（title）を書き換える -->
<!-- 2. 学籍番号と、名前を自分のものに書き換える。 -->
<!-- 3.　下の、コードチャンク setup を実行する。 -->

```{r setup, include=FALSE}
library(tidyverse)
library(readxl)
library(WDI)
```

まだ、`data` フォルダを作成していなければ、次のコード・チャンクを実行します。作成してあれば不要です。

```{r eval=FALSE}
dir.create("./data")
```

次も、もし、`data` フォルダーに、`wdi_cache.RData` が入っていれば実行する必要はありません。

```{r eval=FALSE}
wdi_cache <- WDIcache()
write_rds(wdi_cache, "./data/wdi_cache.RData")
```

おそらく、すでに、`wdi_cache.RData` は、`data` フォルダにあると思うのでこの下のコードだけで十分なはずです。

```{r}
wdi_cache <- read_rds("./data/wdi_cache.RData")
```

本来は、皆さんが課題で取り組んでくださったことに対して、しっかりと応答を書くべきところですが、しばらく、時間が取れないので、皆さんが、調べてくださった、WDI コードのリストだけ、書いておきたいと思います。ひょっとすると、漏れているものもあるかと思いますが、それは、お許しください。最初のリストは、コピー・ペーストをしたので、見落とした可能性は大です。しかし、他のクラスメートがどんな指標について調べたのかを知ることは、勉強になると思います。

実は、わたし自身、非常に感銘を受けました。流石に、中級マクロの受講生ですね。調べたい、インディケータをたくさん持っておられる。それを、わたしも確認したいということも、このリストを作った、目的です。

最初のリストを作ってから、やはり、WDI Name と言われる名前や、概要などの情報も欲しいですよね。それをつけたものを、下で作成しています。今回は、そこまでとして、応答は、また時間があればとさせてください。

実は、テンプレートからコピーをするときに、最初の行が落ちているために、Preview ができていなかった人。Notebook ではなく、R Markdown から、HTML を作ったために、コードをみることができなかったもの。

また、OECD などから、データを取ってきて調べてくださった方もおられましたが、そのサイトの URL が書いてなかったので、わたしは、探せなかったものなどもありました。

まあ、それも、練習ですし、今回が最初ですから、そのようなことが起こることは、織り込み済みですから、気にしないでください。少しずつ、質が上がると良いですね。最初の始めてみようには、R Markdown の説明もビデオとともに付けてあります。

そのようなものも見てみると良いでしょう。

海蔵寺先生も言っておられましたが、基本は、

> 身近なデータを取ってきて図にする。一連の作業を文書化する。

だと、思っています。Posit Primers も最初は、Visualization から始めています。わたしも、それがよいと思っています。そして、再現性 (Reproducibility) と、コードチャンクで実行していることを、説明していく、Literate Programming のためのものが、この RNotebook です。再現性は、とても、大切です。自分のためにも。特に、データをどのように取得するかは、丁寧に、書いておいてください。WDI の場合は、コードだけで十分ですが、本来は、取得した日にちも必要です。ただ、それは、上の、Date のところに書いてあり、自動的に、更新されます。

少しずつ進んでいっていただけると嬉しいです。

## みなさんが、選んでくださった、WDI コード

```{r}
url_indicators <- "https://ds-sl.github.io/intro2r/data/indicators.csv"
df_indicators <- read_csv(url_indicators) %>% left_join(wdi_cache$series)
write_csv(df_indicators, "./data/indicators.csv")
df_indicators
```

下のコードを実行してもみることができます。

```{r eval=FALSE}
View(df_indicators)
```

この続きは、いずれ時間があればと、させてください。

# 課題 1 -　Assignment 1

下に４種類、６個のテンプレートがあります。指標 `indicator` と、略称 `short_name` と、いくつかの国名 `chosen_countries` を、入れ替えて、試してみてください。
コピー・ペーストしてもっと増やしても構いません。最低４種類、４個。テンプレートと同じものは不可。

<!-- 1. 調べてみたい WDI の指標をいくつか探して、リストする。 -->
<!-- 2. 下のテンプレートの　indicator, short_name, chosen_country などを調べたいものに変更し、実行する。 -->
<!- - indicator は、WDI コード、short_name は、WDI コードの簡単な名前（英数のみスペースもない方がよい。underscore _ は可。chosen_country はデータに含まれる country 名。wdi_cache でも確認可能） -->


## テンプレート Templates {-}

## 一つの国についての、一つの指標（WDI）と、その略称から、折線グラフ

Line Plot with one indicator with abbreviation and one country

```{r cache=TRUE}
chosen_indicator <- "SL.UEM.TOTL.NE.ZS"
short_name <- "unemployment"
chosen_country <- "United States"
WDI(country = "all", indicator = c(short_name = chosen_indicator), extra=TRUE, cache=wdi_cache) %>%
  filter(country == chosen_country) %>% 
  ggplot(aes(year, short_name)) + geom_line() +
  labs(title = paste("WDI ", chosen_indicator, ": ", short_name, " - ", chosen_country),
       y = short_name)
```


## いくつかの国についての、一つの指標（WDI）と、その略称から、折線グラフ

Line Plot with one indicator with abbreviation and several countries

```{r cache=TRUE}
chosen_indicator <- "SL.UEM.TOTL.NE.ZS"
short_name <- "unemployment"
chosen_countries <- c("United States","United Kingdom", "Japan")
WDI(country = "all", indicator = c(short_name = chosen_indicator), extra=TRUE, cache=wdi_cache) %>% drop_na(short_name) %>% 
  filter(country %in% chosen_countries) %>% 
  ggplot(aes(year, short_name, col = country)) + geom_line() +
  labs(title = paste("WDI ", chosen_indicator, ": ", short_name), y = short_name)
```


## 一つの国についての、二つの指標（WDI）と、その略称から、折線グラフ

Line Plot with two indicators with abbreviation and one country

```{r cache=TRUE}
chosen_indicator_1 <- "NY.GDP.DEFL.KD.ZG"
short_name_1 <- "gdp_deflator"
chosen_indicator_2 <- "CPTOTSAXNZGY"
short_name_2 <- "cpi_price"
chosen_country <- "United States"
WDI(country = "all", indicator = c(short_name_1 = chosen_indicator_1, short_name_2 = chosen_indicator_2), extra=TRUE, cache=wdi_cache) %>% 
  filter(country == chosen_country) %>% 
  pivot_longer(c(short_name_1, short_name_2), names_to = "class", values_to = "value") %>% drop_na(value) %>%
  ggplot(aes(year, value, col = class)) + geom_line() +
  labs(title = paste("WDI ", chosen_indicator_1, ": ", short_name_1, "\n", chosen_indicator_2, ": ", short_name_2, " - ", chosen_country)) +
  scale_color_manual(labels = c(short_name_1, short_name_2), values = scales::hue_pal()(2))
```

```{r cache=TRUE}
chosen_indicator_1 <- "SL.TLF.CACT.MA.NE.ZS"
short_name_1 <- "male"
chosen_indicator_2 <- "SL.TLF.CACT.FE.NE.ZS"
short_name_2 <- "female"
chosen_country <- "United States"
WDI(country = "all", indicator = c(short_name_1 = chosen_indicator_1, short_name_2 = chosen_indicator_2), extra=TRUE, cache=wdi_cache) %>% 
  filter(country == chosen_country) %>% 
  pivot_longer(c(short_name_1, short_name_2), names_to = "class", values_to = "value") %>% drop_na(value) %>%
  ggplot(aes(year, value, col = class)) + geom_line() +
  labs(title = paste("WDI ", chosen_indicator_1, ": ", short_name_1, "\n", chosen_indicator_2, ": ", short_name_2, " - ", chosen_country)) +
  scale_color_manual(labels = c(short_name_1, short_name_2), values = scales::hue_pal()(2))
```

## いくつかの国についての、二つの指標（WDI）と、その略称から、折線グラフ

Line Plot with two indicators with abbreviation and several countries

```{r cache=TRUE}
chosen_indicator_1 <- "NY.GDP.DEFL.KD.ZG"
short_name_1 <- "gdp_deflator"
chosen_indicator_2 <- "CPTOTSAXNZGY"
short_name_2 <- "cpi_price"
chosen_countries <- c("United States", "France", "Japan")
WDI(country = "all", indicator = c(short_name_1 = chosen_indicator_1, short_name_2 = chosen_indicator_2), extra=TRUE, cache=wdi_cache) %>% 
  filter(country %in% chosen_countries) %>% 
  pivot_longer(c(short_name_1, short_name_2), names_to = "class", values_to = "value") %>% drop_na(value) %>%
  ggplot(aes(year, value, linetype = class, col = country)) + geom_line() +
  labs(title = paste("WDI ", chosen_indicator_1, ": ", short_name_1, "\n", chosen_indicator_2, ": ", short_name_2)) +
  scale_linetype_manual(labels = c(short_name_1, short_name_2), values = c("solid", "dashed"))
```


```{r cache=TRUE}
chosen_indicator_1 <- "SL.TLF.CACT.MA.NE.ZS"
short_name_1 <- "male"
chosen_indicator_2 <- "SL.TLF.CACT.FE.NE.ZS"
short_name_2 <- "female"
chosen_countries <- c("United States", "France", "Japan")
WDI(country = "all", indicator = c(short_name_1 = chosen_indicator_1, short_name_2 = chosen_indicator_2), extra=TRUE, cache=wdi_cache) %>% 
  filter(country %in% chosen_countries) %>% 
  pivot_longer(c(short_name_1, short_name_2), names_to = "class", values_to = "value") %>% drop_na(value) %>%
  ggplot(aes(year, value, linetype = class, col = country)) + geom_line() +
  labs(title = paste("WDI ", chosen_indicator_1, ": ", short_name_1, "\n", chosen_indicator_2, ": ", short_name_2)) +
  scale_linetype_manual(labels = c(short_name_1, short_name_2), values = c("solid", "dashed"))
```


# 課題 2 - Assignment 2

探索的データ解析を経験してみよう。

1. 興味のあるデータ（または関連するいくつかのデータ）を見つける。
  - [重要] なぜ、そのデータに興味を持ったか。
  - WDI や、OECD や、UN Data。
  - 課題1 と同じものでも構いません。しかし、選んだ理由を書くこと。
2. データを読み込む。
3. [重要] データに関する問い。
4. [重要] 可能な範囲で、データの可視化をして、得られたこと。
5. 難しかったこと、できなかったこと。





課題 1 と　課題 2 を、課題 テンプレートを用いて、書き、ID.nb.html ファイル を、2月24日（土）深夜までに Moodle 上に提出。
