---
title: "Data Analysis for Researchers 2023, Week 3"
author: "Hiroshi Suzuki"
date: "2024/01/10"
output:
  ioslides_presentation:
    widescreen: yes
    df_print: paged
  html_notebook: default
---

# Part I: EDA with WDI

## Exploratory Data Analysis

-   Statistics vs Data Science

-   Hypothesis Testing vs Hypothesis Creating

-   Problem Solving vs Understanding Issues (to Attack Problems)

## A short introduction to EDA workflow

1.  Start RStudio

2.  Create or open a project

    -   File \> Open Project or File \> Recent Projects (or File \> New Project)

3.  R Notebook, R Markdown, Quarto (or R Script, Console)

    -   Reproducibility, Literate Programming and for Communication

    -   R Notebook: HTML file with R Markdown source file

### Exercise

-   Purchasing power parities (PPPs) [[Link](https://ds-sl.github.io/intro2r/da4r/gdp_ppp.nb.html)], [[Rmd](https://github.com/ds-sl/intro2r/blob/main/docs/da4r/gdp_ppp.Rmd)]

-   Life Expectancy [[Link](https://ds-sl.github.io/intro2r/da4r/life_expectancy.nb.html)], [[Rmd](https://github.com/ds-sl/intro2r/blob/main/docs/da4r/life_expectancy.Rmd)]

## Review - Week 2

### World Development Indicators

-   Data themes [[Link](https://datatopics.worldbank.org/world-development-indicators/)]

-   People [[Link](https://datatopics.worldbank.org/world-development-indicators/themes/people.html)]

    -   Life-expectancy

        -   R Notebook [[Link to the source](https://github.com/ds-sl/intro2r/blob/main/docs/da4r/life_expectancy.Rmd)], [[R Notebook](https://ds-sl.github.io/intro2r/da4r/life_expectancy.nb.html)]

        -   World Development Indicators: life-expectancy

            -   Population, total: SP.POP.TOTL [[Link](https://data.worldbank.org/indicator/SP.POP.TOTL)]

            -   Fertility rate, total (births per woman): SP.DYN.TFRT.IN [[Link](https://data.worldbank.org/indicator/SP.DYN.TFRT.IN)]

            -   Life expectancy at birth, total: SP.DYN.LE00.IN [[Link](https://data.worldbank.org/indicator/SP.DYN.LE00.IN)]

## Preview

-   Week 3, Jan. 10: EDA2, WDI, data transformation, data visualization

-   Week 4, Jan. 17: EDA3, WDI, tidy data (long and wide data), choropleth maps

-   Week 5, Jan. 24: EDA4, UN, OECD, readr, readxl, two table verves

-   Week 6, Jan. 31: EDA5, Round-up, communication, pdf, Word, PowerPoint

------------------------------------------------------------------------

### WDI Package

CRAN Package Site: WDI [[https://CRAN.R-project.org/package=WDI](https://cran.r-project.org/package=WDI)]

**WDI: World Development Indicators and Other World Bank Data**

The WDI function provides convenient access to over 40 databases hosted by the World Bank, including the World Development Indicators (WDI), International Debt Statistics, Doing Business, Human Capital Index, and Sub-national poverty indicators. For fast searching, the WDI package ships with a local list of available data series. This local list can be updated to the latest version using the WDIcache function.

Search: CRAN package=WDI.

See URL, News and Reference Manual in the page.

*For other packages use a similar syntax 'CRAN package='Package Name'*

------------------------------------------------------------------------

### Data Importing

```{r setup, echo=FALSE}
library(tidyverse)
library(WDI)
```

```{r df_lifeexp, eval=FALSE}
df_lifeexp <- WDI(indicator = c(pop = "SP.POP.TOTL", 
                  fertility = "SP.DYN.TFRT.IN", 
                  lifeexp = "SP.DYN.LE00.IN"), 
                  extra = TRUE)
```

Default values are filled automatically. See Help WDI

```{r dflifeexp, eval=FALSE}
df_lifeexp <- WDI(country = "all", 
                  indicator = c(pop = "SP.POP.TOTL", 
                  fertility = "SP.DYN.TFRT.IN", 
                  lifeexp = "SP.DYN.LE00.IN"), 
                  start = 1960, end = NULL, 
                  extra = TRUE, cache = NULL, latest = NULL, 
                  language = "en")
```

------------------------------------------------------------------------

### Data Transforming

-   `dplyr`, a package in tidyverse

    -   `select()` : select columns `select(c(1,2,4,5,7,8))`

    -   `filter()` : select rows meeting a condition

        -   `filter(country == "World")`

        -   `filter(iso2c %in% c("JP", "IN", "CN"))`

        -   `filter(region != "Aggregates")`

    -   `distinct()` : select rows with distinct values of a variable `distinct(country)`

    -   `drop_na()` : drop rows with NA values, e.g. `drop_na(pop)`

------------------------------------------------------------------------

### Data Visualizing

-   ggplot2

    -   `ggplot(aes(x=var1, y=var2)) +`

    -   Scatter Plot: `geom_point(aes(col=var3, size=var4, shape=var5))`

    -   Line Graph: `geom_line(aes(col=var3, linetype=var4)))`

    -   Title, Subtitle, Legend and Axis labels

        -   `labs(title = "", subtitle ="", x  = "", y = "", col = "")`

------------------------------------------------------------------------

### Examples [[Link](https://ds-sl.github.io/intro2r/da4r/life_expectancy.nb.html)]

#### Line graph

```{r dflife, echo=FALSE, message=FALSE}
df_wdi_life <- read_csv("data/wdi_life.csv")
df_life <- df_wdi_life |> select(c("country", "iso2c", "year", "life_expectancy", "fertility_rate", "population", "region", "income"))
```

```{r lineplot}
df_life |> filter(country == "World") |> 
  drop_na(life_expectancy) |>
  ggplot(aes(year, life_expectancy)) + geom_line() +
  labs(title = "Life expectancy of the World")
```

------------------------------------------------------------------------

#### Scatter Plot

```{r scatterplot}
df_life |> filter(year == 2021) |>
  filter(region != "Aggregates") |> 
  drop_na(fertility_rate, life_expectancy) |>
  ggplot(aes(fertility_rate, life_expectancy, col = region)) + 
  geom_point()
```

------------------------------------------------------------------------

### World Development Indicators

-   Data themes [[Link](https://datatopics.worldbank.org/world-development-indicators/)]

-   Data Catalog: World Development Indicators [[Link](https://datacatalog.worldbank.org/search/dataset/0037712/World-Development-Indicators)]

-   The World by Income and Region [[Link](https://datatopics.worldbank.org/world-development-indicators/the-world-by-income-and-region.html)]

-   World Bank Country and Lending Groups [[Link](https://datahelpdesk.worldbank.org/knowledgebase/articles/906519-world-bank-country-and-lending-groups)]

-   WDI Package

    -   WDI(), WDIcache(), WDIsearch()

------------------------------------------------------------------------

### WDIcache() [[Link in da4r](https://icu-hsuzuki.github.io/da4r/wdidata.html?q=WDIcache#wdicache)]

See Help.

```{r wdicache, eval=FALSE}
wdicache <- WDIcache()
```

```{r writewdicache, eval=FALSE, echo=FALSE}
write_rds(wdicache, "data/wdicache.rds")
```

```{r readwdicache, echo=FALSE}
wdicache <- read_rds("data/wdicache.rds")
```

```{r}
str(wdicache)
```

------------------------------------------------------------------------

```{r}
str(wdicache, max.level=1)
```

------------------------------------------------------------------------

```{r}
wdicache$series
```

------------------------------------------------------------------------

```{r}
wdicache$country
```

------------------------------------------------------------------------

### Write and/or Read Lists

```{r eval=FALSE}
write_rds(wdicache, "data/wdicache.rds")
```

```{r eval=FALSE}
wdicache <- read_rds("data/wdicache.rds")
```

------------------------------------------------------------------------

### WDIsearch() [[Link in da4r](https://icu-hsuzuki.github.io/da4r/a3resp.html?q=WDIsearch#wdisearch)]

```{r}
WDIsearch(string = "education", field = "name", short = TRUE, cache = wdicache)
```

`wdibulk <- WDIbulk(timeout=600)`

```         
List of 6
 $ Data          : tibble [24,902,388 × 6] (S3: tbl_df/tbl/data.frame)
 $ Country       :'data.frame': 265 obs. of  31 variables:
 $ Series        :'data.frame': 1486 obs. of  21 variables:
 $ Country-Series:'data.frame': 8241 obs. of  4 variables:
 $ Series-Time   :'data.frame': 148 obs. of  4 variables:
 $ FootNote      :'data.frame': 741689 obs. of  5 variables:
```

------------------------------------------------------------------------

### group_by, summarize [[Link in da4r](https://dplyr.tidyverse.org/reference/group_by.html)]

```{r}
df_iris <- datasets::iris
```

```{r}
df_iris |> group_by(Species) |>
  summarize(mean_sl = mean(Sepal.Length), mean_sw = mean(Sepal.Width))
```

------------------------------------------------------------------------

### mutate [[Link in da4r](https://icu-hsuzuki.github.io/da4r/dplyr.html?q=mutate#mutate)]

```{r}
df_iris |> mutate(Sepal.Ratio = Sepal.Length/Sepal.Width)
```

# Part II: Practicum

Co2 per capita [Link], [Rmd]

Week Three Assignment Template [Link], [Rmd]

## Week Three Assignment

Choose two WDI codes and analyse the data.

-   Create an R Notebook of a Data Analysis containing the following and submit the rendered file (eg. `w3_g123456.nb.html`)

    1.  create an R Notebook using the R Notebook Template in Moodle, save as `w3_g123456.Rmd`,

    2.  edit author with name, ID, and title

------------------------------------------------------------------------

-   Contents should include the following:

    -   A short abstract

    -   Description of data including data name, data code (or id), description

    -   A bar graph or a column graph, a histogram, a line graph, a scatter plot

    -   add observations or questions for visualizations

-   run each code block, preview to create `w3_g123456.nb.html`,

-   submit `w3_123456.nb.html` to Moodle.

Submit your R Notebook file (w3_g123456.nb.html) in Moodle (Week Three Assignment).

***Due Sunday 14, January 2024, 11:59 PM***

## Recommended Readings and Activities

1.  World Development Indicators: Data themes [[Link](https://datatopics.worldbank.org/world-development-indicators/)]

2.  How does the World Bank classify countries? [[Link](https://datahelpdesk.worldbank.org/knowledgebase/articles/378834-how-does-the-world-bank-classify-countries)]

3.  Posit Recipes（New edition of Posit Primers）: interactive exercises [[Link](https://posit.cloud/learn/recipes)]

4.  RStudio IDE Cheat Sheet. PDF is available on the top right. [[Site Link](https://rstudio.github.io/cheatsheets/html/rstudio-ide.html)]
