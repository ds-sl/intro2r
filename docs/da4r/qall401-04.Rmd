---
title: "Data Analysis for Researchers 2023, Week 4"
author: "Hiroshi Suzuki"
date: "2024/01/17"
output:
  ioslides_presentation:
    widescreen: yes
    df_print: paged
  html_notebook: default
  html_document:
    df_print: paged
---

# Part I: EDA with WDI

## Week Three Review

-   WDI package

    -   WDI() for importing, WDIcache for updating meta data, WDIsearch for searching and getting data information

-   Transforming data

    -   select, filter, drop_na, distinct, group_by, summarize

-   Visualizing data

    -   line graph, scatterplot, histogram, boxplot, bar and column plot

### Week Three Assignment - Responses

-   Week Three Assignment Template [[Link](https://ds-sl.github.io/intro2r/da4r/w3_assignment_template.nb.html)], [[Rmd](https://github.com/ds-sl/intro2r/blob/main/docs/da4r/w3_assignment_template.Rmd)]

-   Responses to Week Three Assignment [[Link](https://ds-sl.github.io/intro2r/da4r/w3a_response.nb.html)]

## Preview

-   Week 4, Jan. 17: EDA3, WDI, tidy data (long and wide data), choropleth maps

-   Week 5, Jan. 24: EDA4, UN, OECD, readr, readxl, two table verves, modeling

-   Week 6, Jan. 31: EDA5, Round-up, communication, pdf, Word, PowerPoint

## A short introduction to EDA workflow

1.  Start RStudio

2.  Create or open a project

    -   File \> Open Project or File \> Recent Projects (or File \> New Project)

3.  R Notebook, R Markdown, Cuarto (or R Script, Console)

    -   Reproducibility, Literate Programming and for Communication

    -   R Notebook: HTML file with R Markdown source file

## Examples

-   Purchasing power parities (PPPs) [[Link](https://ds-sl.github.io/intro2r/da4r/gdp_ppp.nb.html)], [[Rmd](https://github.com/ds-sl/intro2r/blob/main/docs/da4r/gdp_ppp.Rmd)]

-   Life Expectancy [[Link](https://ds-sl.github.io/intro2r/da4r/life_expectancy.nb.html)], [[Rmd](https://github.com/ds-sl/intro2r/blob/main/docs/da4r/life_expectancy.Rmd)]

-   EDA using WDI: CO~2~ Emissions Per Capita vs GDP Per Capita [[Link](https://ds-sl.github.io/intro2r/da4r/co2pcap.nb.html)], [[Rmd](https://github.com/ds-sl/intro2r/blob/main/docs/da4r/co2pcap.Rmd)]

-   Education [[Link](https://ds-sl.github.io/intro2r/da4r/education.nb.html)], [[Rmd](https://github.com/ds-sl/intro2r/blob/main/docs/da4r/education.Rmd)]

## EDA Workflow with WDI

Start RStudio and open your project.

### Setup

```{r}
library(tidyverse)
library(WDI)
```

------------------------------------------------------------------------

### WDIcache() [[Link in da4r](https://icu-hsuzuki.github.io/da4r/wdidata.html?q=WDIcache#wdicache)]

```{r eval=FALSE}
wdicache <- WDIcache()
```

```{r eval=TRUE, echo=FALSE}
wdicache <- read_rds("data/wdicache.rds")
```

```{r}
str(wdicache, max.level = 1)
```

-   wdicache\$series - WDI and other database

-   wdicache\$country - data about countries, list of countries, regions, income, lending, etc.

------------------------------------------------------------------------

### WDI(..., extra=TRUE, cache=wdicache)

Download data with extra *updated* information

```         
df_yourdata <- WDI(
  indicator = c(short_name_1 = chosen_indicator_1,
                short_name_2 = chosen_indicator_2),
  extra = TRUE, cache = wdicache)
```

------------------------------------------------------------------------

### WDIsearch() [[Link in da4r](https://icu-hsuzuki.github.io/da4r/a3resp.html?q=WDIsearch#wdisearch)]

```         
WDIsearch(string = "education", field = "name")
```

`short=FALSE`: description and source information `cache=wdicache`: updated information

```         
WDIsearch(string = "school enrollment", field = "name", short = FALSE, cache = wdicache)
```

```         
WDIsearch(string = "SE.XPD.TOTL.GD.ZS", field = "indicator", short = FALSE, cache = wdicache)
```

------------------------------------------------------------------------

```{r}
WDIsearch(string = "(% of land area)", field = "name", short = FALSE, cache = wdicache)
```

------------------------------------------------------------------------

```{r}
WDIsearch(string = "(hectares)", field = "name", short = FALSE, cache = wdicache)
```

------------------------------------------------------------------------

```{r}
WDIsearch(string = "(% of GDP)", field = "name", short = FALSE, cache = wdicache)
```

------------------------------------------------------------------------

```{r}
WDIsearch(string = "(% of population)", field = "name", short = FALSE, cache = wdicache)
```

------------------------------------------------------------------------

```{r}
WDIsearch(string = "XPD", field = "indicator", short = FALSE, cache = wdicache)
```

------------------------------------------------------------------------

### Data Importing

```         
df_yourdata <- WDI(
  indicator = c(short_name_1 = chosen_indicator_1,
                short_name_2 = chosen_indicator_2),
  extra = TRUE, cache = wdicache)
```

```         
df_lifeexp <- WDI(
  indicator = c(pop = "SP.POP.TOTL", 
                fertility = "SP.DYN.TFRT.IN", 
                lifeexp = "SP.DYN.LE00.IN"), 
  extra = TRUE, cache = wdicache)
```

```         
df_lifeexp <- WDI(
  indicator = c(pop = "SP.POP.TOTL", 
                fertility = "SP.DYN.TFRT.IN", 
                lifeexp = "SP.DYN.LE00.IN"))
```

------------------------------------------------------------------------

### Data Transforming by `dplyr` and `tidyr`  in `tidyverse`

-   `select()` : select columns `select(c(1,2,4,5,7,8))`

-   `filter()` : select rows meeting a condition

    -   `filter(country == "World")`

    -   `filter(iso2c %in% c("JP", "IN", "CN"))`

    -   `filter(region != "Aggregates")`

-   `distinct()` : select rows with distinct values of a variable `distinct(country)`

-   `drop_na()` : drop rows with NA values, e.g. `drop_na(pop)`

-   `arrange` , `mutate` , `group_by` and `summarize`

------------------------------------------------------------------------

#### `arrange`, `mutate`, `group_by` and `summarize`

```         
df_ed |> group_by(year) |> 
  summarize(expenditure = sum(!is.na(expenditure)), 
                                     primary = sum(!is.na(primary)),
                                     secondary = sum(!is.na(secondary)),
                                     tertiary = sum(!is.na(tertiary))) |>
  arrange(desc(year))
```

#### Long Data vs Wide Data [[r4ds tidyr](https://icu-hsuzuki.github.io/da4r/tidy.html?q=pivot_longer#tidy)]

```         
df |> pivot_longer(cols = c(columns to gather))
```

```         
df |> pivot_longer(cols = c(columns to gather), names_to = "name", values_to = "value")
```

------------------------------------------------------------------------

### Data Visualizing by `ggplot` in `tidyverse`

-   `ggplot(aes(x=var1, y=var2)) + geom_***()`

-   Scatter Plot: `geom_point(aes(col=var3, size=var4, shape=var5))`

-   Line Graph: `geom_line(aes(col=var3, linetype=var4)))`

-   Histogram: `geom_histogram(bins = 20)`, `geom_histogram(binwidth = 5)`

    -   What is a histogram? [[video](https://vimeo.com/221607341)]

-   Boxplot: `geom_boxplot(aes(x = var4, y = var1, fill = var3))`

    -   What is a boxplot? [[video](https://vimeo.com/222358034)]

-   Title, Subtitle, Legend and Axis labels

    -   `labs(title = "", subtitle ="", x  = "", y = "", col = "")`

------------------------------------------------------------------------

#### Choropleth Maps [[r4ds worldmap](https://icu-hsuzuki.github.io/da4r/worldmap.html#worldmap)]

rnaturalearth: [[CRAN](https://cran.r-project.org/web/packages/rnaturalearth/index.html)], [[Manual](https://cran.r-project.org/web/packages/rnaturalearth/rnaturalearth.pdf)], [[URL](https://www.naturalearthdata.com)], rnaturalearthdata: [[CRAN](https://cran.r-project.org/web/packages/rnaturalearthdata/index.html)], [[Manual](https://cran.r-project.org/web/packages/rnaturalearthdata/rnaturalearthdata.pdf)]

```{r message=FALSE}
library(rnaturalearth); library(rnaturalearthdata)
ne_countries() %>% 
  ggplot() + geom_sf(aes(fill = region_wb)) + labs(title = "Regions of World Bank")
```

<!-- ### Examples [[Link](https://ds-sl.github.io/intro2r/da4r/life_expectancy.nb.html)] -->

<!-- #### Line graph -->

<!-- ```          -->

<!-- df_life |> filter(country == "World") |>  -->

<!--   drop_na(life_expectancy) |> -->

<!--   ggplot(aes(year, life_expectancy)) + geom_line() + -->

<!--   labs(title = "Life expectancy of the World") -->

<!-- ``` -->

<!-- #### Scatter Plot -->

<!-- ```          -->

<!-- df_life |> filter(year == 2021) |> -->

<!--   filter(region != "Aggregates") |>  -->

<!--   drop_na(fertility_rate, life_expectancy) |> -->

<!--   ggplot(aes(fertility_rate, life_expectancy, col = region)) +  -->

<!--   geom_point() -->

<!-- ``` -->

<!-- ------------------------------------------------------------------------ -->

# Part II: Practicum

## Education

### World Development Indicators: Data themes [[Link](https://datatopics.worldbank.org/world-development-indicators/)]

-   Data Catalog: World Development Indicators [[Link](https://datacatalog.worldbank.org/search/dataset/0037712/World-Development-Indicators)]

-   The World by Income and Region [[Link](https://datatopics.worldbank.org/world-development-indicators/the-world-by-income-and-region.html)]

-   World Bank Country and Lending Groups [[Link](https://datahelpdesk.worldbank.org/knowledgebase/articles/906519-world-bank-country-and-lending-groups)]

-   People [[Link](https://datatopics.worldbank.org/world-development-indicators/themes/people.html)]

    -   Government expenditure on education, total (% of GDP): SE.XPD.TOTL.GD.ZS [[Link](https://data.worldbank.org/indicator/SE.XPD.TOTL.GD.ZS)]

    -   School enrollment, primary (% gross): SE.PRM.ENRR [[Link](https://data.worldbank.org/indicator/SE.PRM.ENRR)]

    -   School enrollment, secondary (% gross): SE.SEC.ENRR [[Link](https://data.worldbank.org/indicator/SE.SEC.ENRR)]

    -   School enrollment, tertiary (% gross): SE.TER.ENRR [[Link](https://data.worldbank.org/indicator/SE.TER.ENRR)]

------------------------------------------------------------------------

### File Links

-   Education [[Link](https://ds-sl.github.io/intro2r/da4r/education.nb.html)], [[Rmd](https://github.com/ds-sl/intro2r/blob/main/docs/da4r/education.Rmd)]

-   Week Four Assignment Template [[Link](https://ds-sl.github.io/intro2r/da4r/w4_assignment_template.nb.html)], [[Rmd](https://github.com/ds-sl/intro2r/blob/main/docs/da4r/w4_assignment_template.Rmd)]

## Week Four Assignment

Choose at least two *similar* WDI codes with the *same scale*, and analyze the data.

-   Create an R Notebook of a data analysis containing the following and submit the rendered file (e.g., `w4_g123456.nb.html`) in Moodle.

    1.  Create an R Notebook using the R Notebook Template in Moodle and save it as `w4_g123456.Rmd`.

    2.  Edit author with name, ID, and title.

------------------------------------------------------------------------

-   Contents should include the following:

    -   A short abstract

    -   Information of data including data name, data code (or id), description

    -   Data including at least two indicators and a long table created using `pivot_longer`

    -   A line graph using the long table with a color aesthetic to depict at least two indicators in a chart.

    -   Several charts: a bar graph or a column graph, a histogram, a line graph, a scatter plot

    -   Observations or questions for visualizations

-   Include a choropleth map, if possible. (a challenge, not required)

------------------------------------------------------------------------

-   Run each code block and preview to create `w4_g123456.nb.html`.

    -   Or, Run All under Run and Preview to check in your web browser!

    -   You can also view your file (e.g. `w4_g123456.nb.html`) by opening it from your web browser.

Submit your R Notebook file (w4_g123456.nb.html) in Moodle (Week Four Assignment).

***Due Sunday 21, January 2024, 11:59 PM***

## Recommended Readings and Activities

1.  World Development Indicators: Data themes [[Link](https://datatopics.worldbank.org/world-development-indicators/)]

    -   Find data you want to study. Record the name, WDI code, and possibly the URL.

2.  Posit Recipes（New edition of Posit Primers）: interactive exercises [[Link](https://posit.cloud/learn/recipes)]

3.  Data visualization with ggplot2. PDF is available on the top right. [[Site Link](https://rstudio.github.io/cheatsheets/html/data-visualization.html)]

4.  Data transformation with dplyr. PDF is available on the top right. [[Site Link](https://rstudio.github.io/cheatsheets/html/data-transformation.html)]

5.  Data tidying with tidyr. PDF is available on the top right. [[Site Link](https://rstudio.github.io/cheatsheets/html/tidyr.html)]
