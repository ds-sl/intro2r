---
title: "Responses to Week Five Assignment"
author: "ID Last, First"
date: "`r Sys.Date()`"
output:
  html_notebook: default
---

## Week Five Assignment

Choose a data from UN data or OECD data.

-   Create an R Notebook of a data analysis containing the following and submit the rendered file (e.g., `w5_g123456.nb.html`) in Moodle.

    1.  Create an R Notebook using the R Notebook Template in Moodle and save it as, for example, `w5_g123456.Rmd`.

    2.  Edit author with name, ID, and title.

-   Contents should include the following:

    -   A short abstract

    -   Information of data including data name, description and link to reach the data

    -   Several charts: a bar graph or a column graph, a histogram, a line graph, a scatter plot

    -   Observations or questions for visualizations

-   Use left_join, if possible. (a challenge, not required)

-   Run each code block and preview to create, for example, `w5_g123456.nb.html`.

    -   Or, Run All under Run and Preview to check in your web browser!

    -   You can also view your file (e.g. `w5_g123456.nb.html`) by opening it from your web browser.

Submit your R Notebook file (w5_g123456.nb.html) in Moodle (Week Five Assignment).

***Due Sunday 28, January 2024, 11:59 PM***

# Your Project

## Title of your project

*The title can be in the title in YAML.*

### Short Abstract

We study .....

## Setup

Install a package `countrycode` first.

```{r}
library(tidyverse)
library(WDI)
library(readxl)
library(countrycode)
```


## Importing Data

## Viewing Data

## Visualization and Analysis

*Do not forget to add observations and questions.*


### About Data

#### List of Data Chosen:

1.  UN population: https://data.un.org/_Docs/SYB/CSV/SYB66_246_202310_Population%20Growth,%20Fertility%20and%20Mortality%20Indicators.csv
2.  UN (FAO) palm oil: data attached UNdata_Export_20240128_153052531.csv
3.  UN Human resources in R & D: [Link](https://data.un.org/_Docs/SYB/CSV/SYB66_285_202310_Research%20and%20Development%20Staff%20and%20researchers%20in%20full%20time%20equivalent.csv) URL https://data.un.org/_Docs/SYB/CSV/SYB66_285_202310_Research%20and%20Development%20Staff%20and%20researchers%20in%20full%20time%20equivalent.csv
4.  UN Consumer Price Index, Employment: https://data.un.org/_Docs/SYB/CSV/SYB66_128_202310_Consumer%20Price%20Index.csv, https://data.un.org/_Docs/SYB/CSV/SYB66_200_202310_Employment.csv
5.  OECD CIP country weight:  https://data-explorer.oecd.org/vis?fs[0]=Topic%2C0%7CEconomy%23ECO%23&fs[1]=Topic%2C1%7CEconomy%23ECO%23%7CPrices%23ECO_PRI%23&pg=0&fc=Topic&snb=16&df[ds]=dsDisseminateFinalDMZ&df[id]=DSD_CPI_COU_WEIGHTS%40DF_CPI_CTRY_WEIGHTS&df[ag]=OECD.SDD.TPS&df[vs]=1.0&pd=%2C&dq=.A..&ly[rw]=REF_AREA&ly[cl]=TIME_PERIOD&to[TIME_PERIOD]=false&lo=5&lom=LASTNPERIODS
6.  UN Population in the capital city, urban and rural areas: https://data.un.org/_Docs/SYB/CSV/SYB61_253_Population%20Growth%20Rates%20in%20Urban%20areas%20and%20Capital%20cities.csv
7.  OECD: Venture capital investments (market statistics), Gross domestic product (GDP)
8.  OECD: https://data-explorer.oecd.org/vis?fs[0]=Topic%2C1%7CSociety%23SOC%23%7CWell-being%20and%20beyond%20GDP%23SOC_WEL%23&pg=0&fc=Topic&bp=true&snb=2&vw=tb&df[ds]=dsDisseminateFinalDMZ&df[id]=DSD_CWB%40DF_CWB&df[ag]=OECD.WISE.CWB&df[vs]=1.0&pd=2018%2C2018&dq=.A4_3%2BA4_2%2BA4_6.A4&ly[cl]=MEASURE&ly[rw]=REF_AREA&to[TIME_PERIOD]=false
9.  UN (UNCHR): total number of forcibly displaced people [Link](https://data.un.org/Data.aspx?d=UNHCR&f=indID%3aType-Ref)
10. Ease of doing business (EODB) score [Link]( https://data.un.org/Data.aspx?d=WDI&f=Indicator_Code%3aIC.BUS.DFRN.XQ), CPIA business regulatory environment rating [Link](https://data.un.org/Data.aspx?q=cpia&d=WDI&f=Indicator_Code%3aIQ.CPA.BREG.XQ)
11. The world inequaluty report 2022 Executive Report F4: https://wir2022.wid.world/www-site/uploads/2022/03/WIR2022TablesFigures-Summary.xlsx
12. WIR Executive Report: https://wir2022.wid.world/www-site/uploads/2022/03/WIR2022TablesFigures-Summary.xlsx
13. OECD: Tertiary graduation rate of women (PhD graduation, women) [Link]( https://data.oecd.org/students/tertiary-graduation-rate.htm)
14. Tax on personal income: OECD [Link](https://stats.oecd.org/sdmx-json/data/DP_LIVE/.TAXINCOME.TOT.PC_GDP.A/OECD?contentType=csv&detail=code&separator=comma&csv-lang=en&startPeriod=2000)
15. OECD: “ICT Access and Usage by Individuals” [URL CSV](https://sdmx.oecd.org/public/rest/data/OECD.STI.STP,DSD_MSTI@DF_MSTI,1.1/.A.G.PT_B1GQ..?startPeriod=2014&dimensionAtObservation=AllDimensions&format=csvfilewithlabels), “Main Science and Technology Indicators” [URL Excel](https://datacatalogfiles.worldbank.org/ddh-published/0037712/DR0090755/CLASS.xlsx)
16. OECD: fluctuations by analyzing the catch files:
17. UN: gender gap in education:  https://data.un.org/_Docs/SYB/CSV/SYB66_319_202310_Ratio%20of%20girls%20to%20boys%20in%20education.csv
18. UN: urbanization (Capital city population (thousands)
Urban population (percent growth rate per annum)
Rural population (percent growth rate per annum))
19. UN: Anthracite - commerce and public services
20: WID: World Inequality Database. The data sheet selected was data F4 [URL](https://wir2022.wid.world/www-site/uploads/2022/03/WIR2022TablesFigures-Summary.xlsx), UN Health Data
21. OECD Child Well-Being: [Link](https://data-explorer.oecd.org/vis?fs[0]=Topic%2C1%7CSociety%23SOC%23%7CWell-being%20and%20beyond%20GDP%23SOC_WEL%23&pg=0&fc=Topic&bp=true&snb=2&vw=tb&df[ds]=dsDisseminateFinalDMZ&df[id]=DSD_CWB%40DF_CWB&df[ag]=OECD.WISE.CWB&df[vs]=1.0&pd=2018%2C2018&dq=.A4_3%2BA4_2%2BA4_6.A4&ly[cl]=MEASURE&ly[rw]=REF_AREA&to[TIME_PERIOD]=false)
22. UN Data - Government expenditure on education as % of GDP: [Link](https://data.un.org/Data.aspx?q=education+expenditure&d=UNESCO&f=series%3aXGDP_FSGOV), UN Data - Gross Enrolment Ratio - Tertiary Education: [Link](https://data.un.org/Data.aspx?q=tertiary&d=GenderStat&f=inID%3a65)


### Examples


*Let me illustrate steps using the following indicators. Issues are not taken from the analysis of the one who chose these indicators.*

1.  UN Data - Government expenditure on education as % of GDP: [Link](https://data.un.org/Data.aspx?q=education+expenditure&d=UNESCO&f=series%3aXGDP_FSGOV), 2.  UN Data - Gross Enrolment Ratio - Tertiary Education: [Link](https://data.un.org/Data.aspx?q=tertiary&d=GenderStat&f=inID%3a65)

*When download the data, choose country codes from 'Select columns'. The first data adds iso3c codes and the second adds UN number codes.*

*It is helpful to add links to the site.*

### Set up

```{r}
library(tidyverse)
```

*Create data folder if you do not have it under Files.*

```{r eval=FALSE}
dir.create("data")
```

*If you do not have `wdicache.rds` in your data folder, run the following two code chunks.*

```{r wdicache, eval=FALSE}
wdicache <- WDIcache()
```

```{r writewdicache, eval=FALSE, echo=FALSE}
write_rds(wdicache, "data/wdicache.rds")
```

```{r readwdicache, echo=FALSE}
wdicache <- read_rds("data/wdicache.rds")
```

### Information of Data


### Importing Data

Edit short_name_1, chosen_indicator_1, short_name_2, chosen_indicator_2, etc. You can edit `df_yourdata` to a descriptive name. If you edit `df_yourdata` , please edit other parts as well.

```{r}
df_ed_gov_exp <- read_csv("data/UNdata_Export_20240131_024758033.csv")
df_ed_gov_exp
```

```{r}
df_ed_gov_exp |> str()
```

```{r}
df_ed_gov_exp |> select(`Time Period`, Sex, `Age group`, `Units of measurement`) |> lapply(unique)
```

```{r}
df_gov_exp <- df_ed_gov_exp |> 
  select(iso3c = `Reference Area Code`, country = `Reference Area`, `Time Period`, gov_exp = `Observation Value`) |> mutate(year = as.integer(`Time Period`), .after = country) |> 
  select(-`Time Period`) |> arrange(country, iso3c, year)
df_gov_exp
```

```{r}
df_tertiary_ratio <- read_csv("data/UNdata_Export_20240131_024820801.csv")
df_tertiary_ratio
```

```{r}
df_tertiary_ratio |> str()
```

```{r}
df_tertiary_ratio |> select(Subgroup, Year, Source, Unit, `Value Footnotes`) |> lapply(unique)
```

```{r}
df_tertiary <- df_tertiary_ratio |> select(un_code = `Country or Area Code`, country = `Country or Area`, sex = Subgroup, Year, tertiary = Value) |> mutate(year = as.integer(Year), .before = sex, tertiary = as.numeric(tertiary)) |> select(-Year)
df_tertiary
```

```{r}
setdiff(unique(df_gov_exp$country), unique(df_tertiary$country))
```

```{r}
setdiff(unique(df_tertiary$country), unique(df_gov_exp$country))
```

**Country Names are different.**

```{r}
df_tertiary |> 
  mutate(iso3c = countrycode(country, "country.name", "iso3c"), .after = un_code) |> 
  filter(is.na(iso3c)) |> distinct(country)
```

```{r}
df_gov_exp |> filter(country %in% c("Netherlands Antilles", "Serbia and Montenegro"))
```

```{r}
df_tertiary1 <- df_tertiary |> 
  mutate(iso3c = countrycode(country, "country.name", "iso3c"), .after = un_code) |> 
  select(-country, -un_code) |> filter(!is.na(iso3c))
df_tertiary1
```

```{r}
df_un_ed_combined <- df_gov_exp |> full_join(df_tertiary1, by = c("iso3c", "year"))
df_un_ed_combined
```

```{r}
df_un_ed_combined |> filter(country %in% c("Japan", "Viet Nam", "China", "Republic of Korea", "United States of America")) |> drop_na(gov_exp) |>
  ggplot(aes(year, gov_exp, col = country)) + geom_line() +
  labs(title = "Five Countries' Goverment Expenditure on Education")
```

```{r}
df_un_ed_combined |> filter(country %in% c("Japan", "Viet Nam", "China", "Republic of Korea", "United States of America")) |> drop_na(tertiary)
```

```{r}
df_un_ed_combined |> filter(country %in% c("Japan", "Viet Nam", "China", "Republic of Korea", "United States of America")) |> drop_na(tertiary) |>
  ggplot(aes(year, tertiary, col = country, linetype = sex)) + geom_line()
```

```{r}
df_un_ed_combined |> filter(country %in% c("Japan", "Viet Nam", "China", "Republic of Korea", "United States of America")) |> drop_na(tertiary) |>
  ggplot(aes(year, tertiary, col = country, linetype = sex)) + geom_line() + 
  scale_y_log10() + labs(title = "Gross Enrolment Ratio in Tertiary Education", subtitle = "Log 10 Scale in Number")
```

